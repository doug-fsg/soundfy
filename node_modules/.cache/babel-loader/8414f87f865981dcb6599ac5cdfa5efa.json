{"remainingRequest":"C:\\teste-login\\node_modules\\babel-loader\\lib\\index.js!C:\\teste-login\\node_modules\\eslint-loader\\index.js??ref--12-0!C:\\teste-login\\src\\Playlist.js","dependencies":[{"path":"C:\\teste-login\\src\\Playlist.js","mtime":1713796821329},{"path":"C:\\teste-login\\babel.config.js","mtime":1713903577360},{"path":"C:\\teste-login\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1713973011099},{"path":"C:\\teste-login\\node_modules\\babel-loader\\lib\\index.js","mtime":1713973011327},{"path":"C:\\teste-login\\node_modules\\eslint-loader\\index.js","mtime":1713973006832}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiQzovdGVzdGUtbG9naW4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZi5qcyI7CmltcG9ydCBfcmVnZW5lcmF0b3JSdW50aW1lIGZyb20gIkM6L3Rlc3RlLWxvZ2luL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9yZWdlbmVyYXRvclJ1bnRpbWUuanMiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiQzovdGVzdGUtbG9naW4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkM6L3Rlc3RlLWxvZ2luL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjay5qcyI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQzovdGVzdGUtbG9naW4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUNsYXNzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnNsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLmRldGFjaGVkLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnRyYW5zZmVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnRyYW5zZmVyLXRvLWZpeGVkLWxlbmd0aC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5qc29uLnN0cmluZ2lmeS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLnRvLWpzb24uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuZGVsZXRlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmhhcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5zaXplLmpzIjsKaW1wb3J0IF9kZWZhdWx0cyBmcm9tICJsb2Rhc2guZGVmYXVsdHNkZWVwIjsKaW1wb3J0IGggZnJvbSAidmlydHVhbC1kb20vaCI7CmltcG9ydCBkaWZmIGZyb20gInZpcnR1YWwtZG9tL2RpZmYiOwppbXBvcnQgcGF0Y2ggZnJvbSAidmlydHVhbC1kb20vcGF0Y2giOwppbXBvcnQgSW5saW5lV29ya2VyIGZyb20gImlubGluZS13b3JrZXIiOwppbXBvcnQgSlNaaXAgZnJvbSAnanN6aXAnOwppbXBvcnQgeyBwaXhlbHNUb1NlY29uZHMgfSBmcm9tICIuL3V0aWxzL2NvbnZlcnNpb25zIjsKaW1wb3J0IHsgcmVzYW1wbGVBdWRpb0J1ZmZlciB9IGZyb20gIi4vdXRpbHMvYXVkaW9EYXRhIjsKaW1wb3J0IExvYWRlckZhY3RvcnkgZnJvbSAiLi90cmFjay9sb2FkZXIvTG9hZGVyRmFjdG9yeSI7CmltcG9ydCBTY3JvbGxIb29rIGZyb20gIi4vcmVuZGVyL1Njcm9sbEhvb2siOwppbXBvcnQgVGltZVNjYWxlIGZyb20gIi4vVGltZVNjYWxlIjsKaW1wb3J0IFRyYWNrIGZyb20gIi4vVHJhY2siOwppbXBvcnQgUGxheW91dCBmcm9tICIuL1BsYXlvdXQiOwppbXBvcnQgQW5ub3RhdGlvbkxpc3QgZnJvbSAiLi9hbm5vdGF0aW9uL0Fubm90YXRpb25MaXN0IjsKaW1wb3J0IEV4cG9ydFdhdldvcmtlckZ1bmN0aW9uIGZyb20gIi4vdXRpbHMvZXhwb3J0V2F2V29ya2VyIjsKaW1wb3J0IFJlY29yZGVyV29ya2VyRnVuY3Rpb24gZnJvbSAiLi91dGlscy9yZWNvcmRlcldvcmtlciI7CmltcG9ydCBBdWRpb1Byb2plY3QgZnJvbSAiaGVydHpqcyI7CmltcG9ydCBBdWRpb0J1ZmZlclRvV2F2IGZyb20gJ2F1ZGlvYnVmZmVyLXRvLXdhdic7CnZhciBfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgX2RlZmF1bHQpOwogICAgdGhpcy50cmFja3MgPSBbXTsKICAgIHRoaXMuc29sb2VkVHJhY2tzID0gW107CiAgICB0aGlzLm11dGVkVHJhY2tzID0gW107CiAgICB0aGlzLmNvbGxhcHNlZFRyYWNrcyA9IFtdOwogICAgdGhpcy5wbGF5b3V0UHJvbWlzZXMgPSBbXTsKICAgIHRoaXMuY3Vyc29yID0gMDsKICAgIHRoaXMucGxheWJhY2tTZWNvbmRzID0gMDsKICAgIHRoaXMuZHVyYXRpb24gPSAwOwogICAgdGhpcy5zY3JvbGxMZWZ0ID0gMDsKICAgIHRoaXMuc2Nyb2xsVGltZXIgPSB1bmRlZmluZWQ7CiAgICB0aGlzLnNob3dUaW1lc2NhbGUgPSBmYWxzZTsKICAgIC8vIHdoZXRoZXIgYSB1c2VyIGlzIHNjcm9sbGluZyB0aGUgd2F2ZWZvcm0KICAgIHRoaXMuaXNTY3JvbGxpbmcgPSBmYWxzZTsKICAgIHRoaXMuZmFkZVR5cGUgPSAibG9nYXJpdGhtaWMiOwogICAgdGhpcy5tYXN0ZXJHYWluID0gMTsKICAgIHRoaXMuYW5ub3RhdGlvbnMgPSBbXTsKICAgIHRoaXMuZHVyYXRpb25Gb3JtYXQgPSAiaGg6bW06c3MudXV1IjsKICAgIHRoaXMuaXNBdXRvbWF0aWNTY3JvbGwgPSBmYWxzZTsKICAgIHRoaXMucmVzZXREcmF3VGltZXIgPSB1bmRlZmluZWQ7CgogICAgLy8gSGVydGp6IHN0dWZmCiAgICB0aGlzLmhlcnR6anNQcm9qZWN0ID0gdW5kZWZpbmVkOwogICAgdGhpcy5oZXJ0anNNYXBwZXIgPSBuZXcgTWFwKCk7CiAgfQogIHJldHVybiBfY3JlYXRlQ2xhc3MoX2RlZmF1bHQsIFt7CiAgICBrZXk6ICJzZXRIZXJ0empzUHJvamVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0SGVydHpqc1Byb2plY3QoaGVydHpqc1Byb2plY3QpIHsKICAgICAgdGhpcy5oZXJ0empzUHJvamVjdCA9IGhlcnR6anNQcm9qZWN0OwogICAgfQoKICAgIC8vIFRPRE8gZXh0cmFjdCBpbnRvIGEgcGx1Z2luCiAgfSwgewogICAga2V5OiAiaW5pdEV4cG9ydGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0RXhwb3J0ZXIoKSB7CiAgICAgIHRoaXMuZXhwb3J0V29ya2VyID0gbmV3IElubGluZVdvcmtlcihFeHBvcnRXYXZXb3JrZXJGdW5jdGlvbik7CiAgICB9CgogICAgLy8gVE9ETyBleHRyYWN0IGludG8gYSBwbHVnaW4KICB9LCB7CiAgICBrZXk6ICJpbml0UmVjb3JkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGluaXRSZWNvcmRlcihzdHJlYW0pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdGhpcy5tZWRpYVJlY29yZGVyID0gbmV3IE1lZGlhUmVjb3JkZXIoc3RyZWFtKTsKICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLm9uc3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHN0YXJ0ID0gX3RoaXMuY3Vyc29yOwogICAgICAgIHZhciB0cmFjayA9IG5ldyBUcmFjaygpOwogICAgICAgIHRyYWNrLnNldE5hbWUoIlJlY29yZGluZyIpOwogICAgICAgIHRyYWNrLnNldEVuYWJsZWRTdGF0ZXMoKTsKICAgICAgICB0cmFjay5zZXRFdmVudEVtaXR0ZXIoX3RoaXMuZWUpOwogICAgICAgIHRyYWNrLnNldFN0YXJ0VGltZShzdGFydCk7CiAgICAgICAgX3RoaXMucmVjb3JkaW5nVHJhY2sgPSB0cmFjazsKICAgICAgICBfdGhpcy50cmFja3MucHVzaCh0cmFjayk7CiAgICAgICAgX3RoaXMuY2h1bmtzID0gW107CiAgICAgICAgX3RoaXMud29ya2luZyA9IGZhbHNlOwogICAgICB9OwogICAgICB0aGlzLm1lZGlhUmVjb3JkZXIub25kYXRhYXZhaWxhYmxlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpcy5jaHVua3MucHVzaChlLmRhdGEpOwoKICAgICAgICAvLyB0aHJvdHRsZSBwZWFrcyBjYWxjdWxhdGlvbgogICAgICAgIGlmICghX3RoaXMud29ya2luZykgewogICAgICAgICAgdmFyIHJlY29yZGluZyA9IG5ldyBCbG9iKF90aGlzLmNodW5rcywgewogICAgICAgICAgICB0eXBlOiAiYXVkaW8vb2dnOyBjb2RlY3M9b3B1cyIKICAgICAgICAgIH0pOwogICAgICAgICAgdmFyIGxvYWRlciA9IExvYWRlckZhY3RvcnkuY3JlYXRlTG9hZGVyKHJlY29yZGluZywgX3RoaXMuYWMpOwogICAgICAgICAgbG9hZGVyLmxvYWQoKS50aGVuKGZ1bmN0aW9uIChhdWRpb0J1ZmZlcikgewogICAgICAgICAgICAvLyBhc2sgd2ViIHdvcmtlciBmb3IgcGVha3MuCiAgICAgICAgICAgIF90aGlzLnJlY29yZGVyV29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBzYW1wbGVzOiBhdWRpb0J1ZmZlci5nZXRDaGFubmVsRGF0YSgwKSwKICAgICAgICAgICAgICBzYW1wbGVzUGVyUGl4ZWw6IF90aGlzLnNhbXBsZXNQZXJQaXhlbAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXMucmVjb3JkaW5nVHJhY2suc2V0Q3VlcygwLCBhdWRpb0J1ZmZlci5kdXJhdGlvbik7CiAgICAgICAgICAgIF90aGlzLnJlY29yZGluZ1RyYWNrLnNldEJ1ZmZlcihhdWRpb0J1ZmZlcik7CiAgICAgICAgICAgIF90aGlzLnJlY29yZGluZ1RyYWNrLnNldFBsYXlvdXQobmV3IFBsYXlvdXQoX3RoaXMuYWMsIGF1ZGlvQnVmZmVyLCBfdGhpcy5tYXN0ZXJHYWluTm9kZSkpOwogICAgICAgICAgICBfdGhpcy5hZGp1c3REdXJhdGlvbigpOwogICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpcy53b3JraW5nID0gZmFsc2U7CiAgICAgICAgICB9KTsKICAgICAgICAgIF90aGlzLndvcmtpbmcgPSB0cnVlOwogICAgICAgIH0KICAgICAgfTsKICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLm9uc3RvcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpcy5jaHVua3MgPSBbXTsKICAgICAgICBfdGhpcy53b3JraW5nID0gZmFsc2U7CiAgICAgICAgX3RoaXMuY3Vyc29yID0gX3RoaXMuZHVyYXRpb24gKyAwLjM7CiAgICAgIH07CiAgICAgIHRoaXMucmVjb3JkZXJXb3JrZXIgPSBuZXcgSW5saW5lV29ya2VyKFJlY29yZGVyV29ya2VyRnVuY3Rpb24pOwogICAgICAvLyB1c2UgYSB3b3JrZXIgZm9yIGNhbGN1bGF0aW5nIHJlY29yZGluZyBwZWFrcy4KICAgICAgdGhpcy5yZWNvcmRlcldvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIF90aGlzLnJlY29yZGluZ1RyYWNrLnNldFBlYWtzKGUuZGF0YSk7CiAgICAgICAgX3RoaXMud29ya2luZyA9IGZhbHNlOwogICAgICAgIF90aGlzLmRyYXdSZXF1ZXN0KCk7CiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0U2hvd1RpbWVTY2FsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U2hvd1RpbWVTY2FsZShzaG93KSB7CiAgICAgIHRoaXMuc2hvd1RpbWVzY2FsZSA9IHNob3c7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TW9ubyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TW9ubyhtb25vKSB7CiAgICAgIHRoaXMubW9ubyA9IG1vbm87CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RXhjbFNvbG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEV4Y2xTb2xvKGV4Y2xTb2xvKSB7CiAgICAgIHRoaXMuZXhjbFNvbG8gPSBleGNsU29sbzsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRTZWVrU3R5bGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFNlZWtTdHlsZShzdHlsZSkgewogICAgICB0aGlzLnNlZWtTdHlsZSA9IHN0eWxlOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFNlZWtTdHlsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2Vla1N0eWxlKCkgewogICAgICByZXR1cm4gdGhpcy5zZWVrU3R5bGU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0U2FtcGxlUmF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U2FtcGxlUmF0ZShzYW1wbGVSYXRlKSB7CiAgICAgIHRoaXMuc2FtcGxlUmF0ZSA9IHNhbXBsZVJhdGU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0U2FtcGxlc1BlclBpeGVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRTYW1wbGVzUGVyUGl4ZWwoc2FtcGxlc1BlclBpeGVsKSB7CiAgICAgIHRoaXMuc2FtcGxlc1BlclBpeGVsID0gc2FtcGxlc1BlclBpeGVsOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEF1ZGlvQ29udGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QXVkaW9Db250ZXh0KGFjKSB7CiAgICAgIHRoaXMuYWMgPSBhYzsKICAgICAgdGhpcy5tYXN0ZXJHYWluTm9kZSA9IGFjLmNyZWF0ZUdhaW4oKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRBdWRpb0NvbnRleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEF1ZGlvQ29udGV4dCgpIHsKICAgICAgcmV0dXJuIHRoaXMuYWM7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Q29udHJvbE9wdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldENvbnRyb2xPcHRpb25zKGNvbnRyb2xPcHRpb25zKSB7CiAgICAgIHRoaXMuY29udHJvbHMgPSBjb250cm9sT3B0aW9uczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRXYXZlSGVpZ2h0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRXYXZlSGVpZ2h0KGhlaWdodCkgewogICAgICB0aGlzLndhdmVIZWlnaHQgPSBoZWlnaHQ7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Q29sbGFwc2VkV2F2ZUhlaWdodCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sbGFwc2VkV2F2ZUhlaWdodChoZWlnaHQpIHsKICAgICAgdGhpcy5jb2xsYXBzZWRXYXZlSGVpZ2h0ID0gaGVpZ2h0OwogICAgfQogIH0sIHsKICAgIGtleTogInNldENvbG9ycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29sb3JzKGNvbG9ycykgewogICAgICB0aGlzLmNvbG9ycyA9IGNvbG9yczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRCYXJXaWR0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QmFyV2lkdGgod2lkdGgpIHsKICAgICAgdGhpcy5iYXJXaWR0aCA9IHdpZHRoOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEJhckdhcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0QmFyR2FwKHdpZHRoKSB7CiAgICAgIHRoaXMuYmFyR2FwID0gd2lkdGg7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0QW5ub3RhdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEFubm90YXRpb25zKGNvbmZpZykgewogICAgICB2YXIgY29udHJvbFdpZHRoID0gdGhpcy5jb250cm9scy5zaG93ID8gdGhpcy5jb250cm9scy53aWR0aCA6IDA7CiAgICAgIHRoaXMuYW5ub3RhdGlvbkxpc3QgPSBuZXcgQW5ub3RhdGlvbkxpc3QodGhpcywgY29uZmlnLmFubm90YXRpb25zLCBjb25maWcuY29udHJvbHMsIGNvbmZpZy5lZGl0YWJsZSwgY29uZmlnLmxpbmtFbmRwb2ludHMsIGNvbmZpZy5pc0NvbnRpbnVvdXNQbGF5LCBjb250cm9sV2lkdGgpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEVmZmVjdHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEVmZmVjdHMoZWZmZWN0c0dyYXBoKSB7CiAgICAgIHRoaXMuZWZmZWN0c0dyYXBoID0gZWZmZWN0c0dyYXBoOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEV2ZW50RW1pdHRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RXZlbnRFbWl0dGVyKGVlKSB7CiAgICAgIHRoaXMuZWUgPSBlZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRFdmVudEVtaXR0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEV2ZW50RW1pdHRlcigpIHsKICAgICAgcmV0dXJuIHRoaXMuZWU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VXBFdmVudEVtaXR0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFVwRXZlbnRFbWl0dGVyKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgICAgdmFyIGVlID0gdGhpcy5lZTsKICAgICAgZWUub24oImF1dG9tYXRpY3Njcm9sbCIsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICBfdGhpczIuaXNBdXRvbWF0aWNTY3JvbGwgPSB2YWw7CiAgICAgIH0pOwogICAgICBlZS5vbigiZHVyYXRpb25mb3JtYXQiLCBmdW5jdGlvbiAoZm9ybWF0KSB7CiAgICAgICAgX3RoaXMyLmR1cmF0aW9uRm9ybWF0ID0gZm9ybWF0OwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICB9KTsKICAgICAgZWUub24oInNlbGVjdCIsIGZ1bmN0aW9uIChzdGFydCwgZW5kLCB0cmFjaykgewogICAgICAgIGlmIChfdGhpczIuaXNQbGF5aW5nKCkpIHsKICAgICAgICAgIF90aGlzMi5sYXN0U2Vla2VkID0gc3RhcnQ7CiAgICAgICAgICBfdGhpczIucGF1c2VkQXQgPSB1bmRlZmluZWQ7CiAgICAgICAgICBfdGhpczIucmVzdGFydFBsYXlGcm9tKHN0YXJ0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gcmVzZXQgaWYgaXQgd2FzIHBhdXNlZC4KICAgICAgICAgIF90aGlzMi5zZWVrKHN0YXJ0LCBlbmQsIHRyYWNrKTsKICAgICAgICAgIF90aGlzMi5lZS5lbWl0KCJ0aW1ldXBkYXRlIiwgc3RhcnQpOwogICAgICAgICAgX3RoaXMyLmRyYXdSZXF1ZXN0KCk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgZWUub24oInN0YXJ0YXVkaW9yZW5kZXJpbmciLCBmdW5jdGlvbiAodHlwZSkgewogICAgICAgIF90aGlzMi5zdGFydE9mZmxpbmVSZW5kZXIodHlwZSk7CiAgICAgIH0pOwogICAgICBlZS5vbigic3RhdGVjaGFuZ2UiLCBmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICBfdGhpczIuc2V0U3RhdGUoc3RhdGUpOwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICB9KTsKICAgICAgZWUub24oInNoaWZ0IiwgZnVuY3Rpb24gKGRlbHRhVGltZSwgdHJhY2spIHsKICAgICAgICB0cmFjay5zZXRTdGFydFRpbWUodHJhY2suZ2V0U3RhcnRUaW1lKCkgKyBkZWx0YVRpbWUpOwogICAgICAgIF90aGlzMi5hZGp1c3REdXJhdGlvbigpOwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICB9KTsKICAgICAgZWUub24oInJlY29yZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIucmVjb3JkKCk7CiAgICAgIH0pOwogICAgICBlZS5vbigicGxheSIsIGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7CiAgICAgICAgX3RoaXMyLnBsYXkoc3RhcnQsIGVuZCk7CiAgICAgIH0pOwogICAgICBlZS5vbigicGF1c2UiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLnBhdXNlKCk7CiAgICAgIH0pOwogICAgICBlZS5vbigic3RvcCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIuc3RvcCgpOwogICAgICB9KTsKICAgICAgZWUub24oInJld2luZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIucmV3aW5kKCk7CiAgICAgIH0pOwogICAgICBlZS5vbigiZmFzdGZvcndhcmQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLmZhc3RGb3J3YXJkKCk7CiAgICAgIH0pOwogICAgICBlZS5vbigiY2xlYXIiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLmNsZWFyKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIuZHJhd1JlcXVlc3QoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCJzb2xvIiwgZnVuY3Rpb24gKHRyYWNrKSB7CiAgICAgICAgX3RoaXMyLnNvbG9UcmFjayh0cmFjayk7CiAgICAgICAgX3RoaXMyLmFkanVzdFRyYWNrUGxheW91dCgpOwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICB9KTsKICAgICAgZWUub24oIm11dGUiLCBmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICBfdGhpczIubXV0ZVRyYWNrKHRyYWNrKTsKICAgICAgICBfdGhpczIuYWRqdXN0VHJhY2tQbGF5b3V0KCk7CiAgICAgICAgX3RoaXMyLmRyYXdSZXF1ZXN0KCk7CiAgICAgIH0pOwogICAgICBlZS5vbigicmVtb3ZlVHJhY2siLCBmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICBfdGhpczIucmVtb3ZlVHJhY2sodHJhY2spOwogICAgICAgIF90aGlzMi5hZGp1c3RUcmFja1BsYXlvdXQoKTsKICAgICAgICBfdGhpczIuZHJhd1JlcXVlc3QoKTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCJjaGFuZ2VUcmFja1ZpZXciLCBmdW5jdGlvbiAodHJhY2ssIG9wdHMpIHsKICAgICAgICBfdGhpczIuY29sbGFwc2VUcmFjayh0cmFjaywgb3B0cyk7CiAgICAgICAgX3RoaXMyLmRyYXdSZXF1ZXN0KCk7CiAgICAgIH0pOwogICAgICBlZS5vbigidm9sdW1lY2hhbmdlIiwgZnVuY3Rpb24gKHZvbHVtZSwgdHJhY2spIHsKICAgICAgICB0cmFjay5zZXRHYWluTGV2ZWwodm9sdW1lIC8gMTAwKTsKICAgICAgICBfdGhpczIuZHJhd1JlcXVlc3QoKTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCJtYXN0ZXJ2b2x1bWVjaGFuZ2UiLCBmdW5jdGlvbiAodm9sdW1lKSB7CiAgICAgICAgX3RoaXMyLm1hc3RlckdhaW4gPSB2b2x1bWUgLyAxMDA7CiAgICAgICAgX3RoaXMyLnRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykgewogICAgICAgICAgdHJhY2suc2V0TWFzdGVyR2FpbkxldmVsKF90aGlzMi5tYXN0ZXJHYWluKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCJmYWRlaW4iLCBmdW5jdGlvbiAoZHVyYXRpb24sIHRyYWNrKSB7CiAgICAgICAgdHJhY2suc2V0RmFkZUluKGR1cmF0aW9uLCBfdGhpczIuZmFkZVR5cGUpOwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICB9KTsKICAgICAgZWUub24oImZhZGVvdXQiLCBmdW5jdGlvbiAoZHVyYXRpb24sIHRyYWNrKSB7CiAgICAgICAgdHJhY2suc2V0RmFkZU91dChkdXJhdGlvbiwgX3RoaXMyLmZhZGVUeXBlKTsKICAgICAgICBfdGhpczIuZHJhd1JlcXVlc3QoKTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCJzdGVyZW9wYW4iLCBmdW5jdGlvbiAocGFudmFsdWUsIHRyYWNrKSB7CiAgICAgICAgdHJhY2suc2V0U3RlcmVvUGFuVmFsdWUocGFudmFsdWUpOwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICB9KTsKICAgICAgZWUub24oImZhZGV0eXBlIiwgZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICBfdGhpczIuZmFkZVR5cGUgPSB0eXBlOwogICAgICB9KTsKICAgICAgZWUub24oIm5ld3RyYWNrIiwgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICBfdGhpczIubG9hZChbewogICAgICAgICAgc3JjOiBmaWxlLAogICAgICAgICAgbmFtZTogZmlsZS5uYW1lCiAgICAgICAgfV0pOwogICAgICB9KTsKICAgICAgZWUub24oImN1dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdHJhY2sgPSBfdGhpczIuZ2V0QWN0aXZlVHJhY2soKTsKICAgICAgICB2YXIgdGltZVNlbGVjdGlvbiA9IF90aGlzMi5nZXRUaW1lU2VsZWN0aW9uKCk7CiAgICAgICAgdHJhY2sucmVtb3ZlUGFydCh0aW1lU2VsZWN0aW9uLnN0YXJ0LCB0aW1lU2VsZWN0aW9uLmVuZCwgX3RoaXMyLmFjLCB0cmFjayk7CiAgICAgICAgdHJhY2suY2FsY3VsYXRlUGVha3MoX3RoaXMyLnNhbXBsZXNQZXJQaXhlbCwgX3RoaXMyLnNhbXBsZVJhdGUpOwogICAgICAgIF90aGlzMi5zZXRUaW1lU2VsZWN0aW9uKDAsIDApOwogICAgICAgIF90aGlzMi5hZGp1c3REdXJhdGlvbigpOwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICAgIF90aGlzMi5lZS5lbWl0KCJjdXRmaW5pc2hlZCIpOwogICAgICB9KTsKICAgICAgZWUub24oInJhem9yQ3V0IiwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBUcmFjayA9IF90aGlzMi5nZXRBY3RpdmVUcmFjaygpOwogICAgICAgIHZhciB0aW1lU2VsZWN0aW9uID0gX3RoaXMyLmdldFRpbWVTZWxlY3Rpb24oKTsKICAgICAgICBUcmFjay5yYXpvckN1dCh0aW1lU2VsZWN0aW9uLnN0YXJ0LCBfdGhpczIuYWMsIFRyYWNrKTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCJ0cmltIiwgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0cmFjayA9IF90aGlzMi5nZXRBY3RpdmVUcmFjaygpOwogICAgICAgIHZhciB0aW1lU2VsZWN0aW9uID0gX3RoaXMyLmdldFRpbWVTZWxlY3Rpb24oKTsKICAgICAgICB0cmFjay50cmltKHRpbWVTZWxlY3Rpb24uc3RhcnQsIHRpbWVTZWxlY3Rpb24uZW5kKTsKICAgICAgICB0cmFjay5jYWxjdWxhdGVQZWFrcyhfdGhpczIuc2FtcGxlc1BlclBpeGVsLCBfdGhpczIuc2FtcGxlUmF0ZSk7CiAgICAgICAgX3RoaXMyLnNldFRpbWVTZWxlY3Rpb24oMCwgMCk7CiAgICAgICAgX3RoaXMyLmFkanVzdER1cmF0aW9uKCk7CiAgICAgICAgX3RoaXMyLmRyYXdSZXF1ZXN0KCk7CiAgICAgIH0pOwogICAgICBlZS5vbigic3BsaXQiLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHRyYWNrID0gX3RoaXMyLmdldEFjdGl2ZVRyYWNrKCk7CiAgICAgICAgdmFyIHRpbWVTZWxlY3Rpb24gPSBfdGhpczIuZ2V0VGltZVNlbGVjdGlvbigpOwogICAgICAgIHZhciB0aW1lU2VsZWN0aW9uU3RhcnQgPSB0aW1lU2VsZWN0aW9uLnN0YXJ0OwogICAgICAgIF90aGlzMi5jcmVhdGVUcmFja0Zyb21TcGxpdCh7CiAgICAgICAgICB0cmFja1RvU3BsaXQ6IHRyYWNrLAogICAgICAgICAgbmFtZTogdHJhY2submFtZSArICJfMSIsCiAgICAgICAgICBzcGxpdFRpbWU6IHRpbWVTZWxlY3Rpb25TdGFydAogICAgICAgIH0pOwogICAgICAgIHRyYWNrLnRyaW0odHJhY2suc3RhcnRUaW1lLCB0aW1lU2VsZWN0aW9uU3RhcnQpOwogICAgICAgIGlmICh0cmFjay5mYWRlT3V0KSB7CiAgICAgICAgICB0cmFjay5yZW1vdmVGYWRlKHRyYWNrLmZhZGVPdXQpOwogICAgICAgICAgdHJhY2suZmFkZU91dCA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgdHJhY2suY2FsY3VsYXRlUGVha3MoX3RoaXMyLnNhbXBsZXNQZXJQaXhlbCwgX3RoaXMyLnNhbXBsZVJhdGUpOwogICAgICAgIF90aGlzMi5kcmF3UmVxdWVzdCgpOwogICAgICB9KTsKICAgICAgZWUub24oInpvb21pbiIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgem9vbUluZGV4ID0gTWF0aC5tYXgoMCwgX3RoaXMyLnpvb21JbmRleCAtIDEpOwogICAgICAgIHZhciB6b29tID0gX3RoaXMyLnpvb21MZXZlbHNbem9vbUluZGV4XTsKICAgICAgICBpZiAoem9vbSAhPT0gX3RoaXMyLnNhbXBsZXNQZXJQaXhlbCkgewogICAgICAgICAgX3RoaXMyLnNldFpvb20oem9vbSk7CiAgICAgICAgICBfdGhpczIuZHJhd1JlcXVlc3QoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBlZS5vbigiem9vbW91dCIsIGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgem9vbUluZGV4ID0gTWF0aC5taW4oX3RoaXMyLnpvb21MZXZlbHMubGVuZ3RoIC0gMSwgX3RoaXMyLnpvb21JbmRleCArIDEpOwogICAgICAgIHZhciB6b29tID0gX3RoaXMyLnpvb21MZXZlbHNbem9vbUluZGV4XTsKICAgICAgICBpZiAoem9vbSAhPT0gX3RoaXMyLnNhbXBsZXNQZXJQaXhlbCkgewogICAgICAgICAgX3RoaXMyLnNldFpvb20oem9vbSk7CiAgICAgICAgICBfdGhpczIuZHJhd1JlcXVlc3QoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBlZS5vbigic2Nyb2xsIiwgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5pc1Njcm9sbGluZyA9IHRydWU7CiAgICAgICAgX3RoaXMyLmRyYXdSZXF1ZXN0KCk7CiAgICAgICAgY2xlYXJUaW1lb3V0KF90aGlzMi5zY3JvbGxUaW1lcik7CiAgICAgICAgX3RoaXMyLnNjcm9sbFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczIuaXNTY3JvbGxpbmcgPSBmYWxzZTsKICAgICAgICB9LCAyMDApOwogICAgICB9KTsKICAgICAgZWUub24oJ2hlcnRqei1sb2FkZWQnLCBmdW5jdGlvbiAoaGVydGp6UHJvamVjdCkgewogICAgICAgIF90aGlzMi5oZXJ0empzUHJvamVjdCA9IGhlcnRqelByb2plY3Q7CiAgICAgICAgX3RoaXMyLmNvcHlGcm9tSGVydHpqcyhoZXJ0anpQcm9qZWN0KTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCdhdWRpb3NvdXJjZXNyZW5kZXJlZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyB0aGlzLmNvbW1pdCgpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudHJhY2tzKQogICAgICAgIC8vY29uc29sZS5sb2codGhpcy5oZXJ0empzUHJvamVjdCkKICAgICAgfSk7CiAgICAgIGVlLm9uKCdjb21taXQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLmNvbW1pdCgpOwogICAgICB9KTsKICAgICAgZWUub24oJ3VuZG8nLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMyLnVuZG8oKTsKICAgICAgfSk7CiAgICAgIGVlLm9uKCdyZWRvJywgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi5yZWRvKCk7CiAgICAgIH0pOwogICAgICBlZS5vbignaW1wb3J0WmlwUHJvamVjdCcsIGZ1bmN0aW9uICh6aXBGaWxlKSB7CiAgICAgICAgX3RoaXMyLmltcG9ydFppcFByb2plY3QoemlwRmlsZSk7CiAgICAgIH0pOwogICAgICBlZS5vbignZXhwb3J0WmlwUHJvamVjdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczIuZXhwb3J0WmlwUHJvamVjdCgpLnRoZW4oZnVuY3Rpb24gKGJsb2IpIHsKICAgICAgICAgIF90aGlzMi5lZS5lbWl0KCJ6aXBQcm9qZWN0RXhwb3J0ZWQiLCBibG9iKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAibG9hZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZCh0cmFja0xpc3QpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CiAgICAgIHZhciBsb2FkUHJvbWlzZXMgPSB0cmFja0xpc3QubWFwKGZ1bmN0aW9uICh0cmFja0luZm8pIHsKICAgICAgICB2YXIgbG9hZGVyID0gTG9hZGVyRmFjdG9yeS5jcmVhdGVMb2FkZXIodHJhY2tJbmZvLnNyYywgX3RoaXMzLmFjLCBfdGhpczMuZWUpOwogICAgICAgIHJldHVybiBsb2FkZXIubG9hZCgpLnRoZW4oZnVuY3Rpb24gKGF1ZGlvQnVmZmVyKSB7CiAgICAgICAgICBpZiAoYXVkaW9CdWZmZXIuc2FtcGxlUmF0ZSA9PT0gX3RoaXMzLnNhbXBsZVJhdGUpIHsKICAgICAgICAgICAgcmV0dXJuIGF1ZGlvQnVmZmVyOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHJlc2FtcGxlQXVkaW9CdWZmZXIoYXVkaW9CdWZmZXIsIF90aGlzMy5zYW1wbGVSYXRlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHJldHVybiBQcm9taXNlLmFsbChsb2FkUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKGF1ZGlvQnVmZmVycykgewogICAgICAgIF90aGlzMy5lZS5lbWl0KCJhdWRpb3NvdXJjZXNsb2FkZWQiKTsKICAgICAgICB2YXIgdHJhY2tzID0gYXVkaW9CdWZmZXJzLm1hcChmdW5jdGlvbiAoYXVkaW9CdWZmZXIsIGluZGV4KSB7CiAgICAgICAgICB2YXIgaW5mbyA9IHRyYWNrTGlzdFtpbmRleF07CiAgICAgICAgICB2YXIgbmFtZSA9IGluZm8ubmFtZSB8fCAiVW50aXRsZWQiOwogICAgICAgICAgdmFyIHN0YXJ0ID0gaW5mby5zdGFydCB8fCAwOwogICAgICAgICAgdmFyIHN0YXRlcyA9IGluZm8uc3RhdGVzIHx8IHt9OwogICAgICAgICAgdmFyIGZhZGVJbiA9IGluZm8uZmFkZUluOwogICAgICAgICAgdmFyIGZhZGVPdXQgPSBpbmZvLmZhZGVPdXQ7CiAgICAgICAgICB2YXIgY3VlSW4gPSBpbmZvLmN1ZWluIHx8IDA7CiAgICAgICAgICB2YXIgY3VlT3V0ID0gaW5mby5jdWVvdXQgfHwgYXVkaW9CdWZmZXIuZHVyYXRpb247CiAgICAgICAgICB2YXIgZ2FpbiA9IGluZm8uZ2FpbiB8fCAxOwogICAgICAgICAgdmFyIG11dGVkID0gaW5mby5tdXRlZCB8fCBmYWxzZTsKICAgICAgICAgIHZhciBzb2xvZWQgPSBpbmZvLnNvbG9lZCB8fCBmYWxzZTsKICAgICAgICAgIHZhciBzZWxlY3Rpb24gPSBpbmZvLnNlbGVjdGVkOwogICAgICAgICAgdmFyIHBlYWtzID0gaW5mby5wZWFrcyB8fCB7CiAgICAgICAgICAgIHR5cGU6ICJXZWJBdWRpbyIsCiAgICAgICAgICAgIG1vbm86IF90aGlzMy5tb25vCiAgICAgICAgICB9OwogICAgICAgICAgdmFyIGN1c3RvbUNsYXNzID0gaW5mby5jdXN0b21DbGFzcyB8fCB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgd2F2ZU91dGxpbmVDb2xvciA9IGluZm8ud2F2ZU91dGxpbmVDb2xvciB8fCB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgc3RlcmVvUGFuID0gaW5mby5zdGVyZW9QYW4gfHwgMDsKICAgICAgICAgIHZhciBlZmZlY3RzID0gaW5mby5lZmZlY3RzIHx8IG51bGw7CgogICAgICAgICAgLy8gd2ViYXVkaW8gc3BlY2lmaWMgcGxheW91dCBmb3Igbm93LgogICAgICAgICAgdmFyIHBsYXlvdXQgPSBuZXcgUGxheW91dChfdGhpczMuYWMsIGF1ZGlvQnVmZmVyLCBfdGhpczMubWFzdGVyR2Fpbk5vZGUpOwogICAgICAgICAgdmFyIHRyYWNrID0gbmV3IFRyYWNrKCk7CiAgICAgICAgICB0cmFjay5zcmMgPSBpbmZvLnNyYzsKICAgICAgICAgIHRyYWNrLnNldEJ1ZmZlcihhdWRpb0J1ZmZlcik7CiAgICAgICAgICB0cmFjay5zZXROYW1lKG5hbWUpOwogICAgICAgICAgdHJhY2suc2V0RXZlbnRFbWl0dGVyKF90aGlzMy5lZSk7CiAgICAgICAgICB0cmFjay5zZXRFbmFibGVkU3RhdGVzKHN0YXRlcyk7CiAgICAgICAgICB0cmFjay5zZXRDdWVzKGN1ZUluLCBjdWVPdXQpOwogICAgICAgICAgdHJhY2suc2V0Q3VzdG9tQ2xhc3MoY3VzdG9tQ2xhc3MpOwogICAgICAgICAgdHJhY2suc2V0V2F2ZU91dGxpbmVDb2xvcih3YXZlT3V0bGluZUNvbG9yKTsKICAgICAgICAgIGlmIChmYWRlSW4gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0cmFjay5zZXRGYWRlSW4oZmFkZUluLmR1cmF0aW9uLCBmYWRlSW4uc2hhcGUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGZhZGVPdXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0cmFjay5zZXRGYWRlT3V0KGZhZGVPdXQuZHVyYXRpb24sIGZhZGVPdXQuc2hhcGUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHNlbGVjdGlvbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIF90aGlzMy5zZXRBY3RpdmVUcmFjayh0cmFjayk7CiAgICAgICAgICAgIF90aGlzMy5zZXRUaW1lU2VsZWN0aW9uKHNlbGVjdGlvbi5zdGFydCwgc2VsZWN0aW9uLmVuZCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocGVha3MgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICB0cmFjay5zZXRQZWFrRGF0YShwZWFrcyk7CiAgICAgICAgICB9CiAgICAgICAgICB0cmFjay5zZXRTdGF0ZShfdGhpczMuZ2V0U3RhdGUoKSk7CiAgICAgICAgICB0cmFjay5zZXRTdGFydFRpbWUoc3RhcnQpOwogICAgICAgICAgdHJhY2suc2V0UGxheW91dChwbGF5b3V0KTsKICAgICAgICAgIHRyYWNrLnNldEdhaW5MZXZlbChnYWluKTsKICAgICAgICAgIHRyYWNrLnNldFN0ZXJlb1BhblZhbHVlKHN0ZXJlb1Bhbik7CiAgICAgICAgICBpZiAoZWZmZWN0cykgewogICAgICAgICAgICB0cmFjay5zZXRFZmZlY3RzKGVmZmVjdHMpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG11dGVkKSB7CiAgICAgICAgICAgIF90aGlzMy5tdXRlVHJhY2sodHJhY2spOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHNvbG9lZCkgewogICAgICAgICAgICBfdGhpczMuc29sb1RyYWNrKHRyYWNrKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBleHRyYWN0IHBlYWtzIHdpdGggQXVkaW9Db250ZXh0IGZvciBub3cuCiAgICAgICAgICB0cmFjay5jYWxjdWxhdGVQZWFrcyhfdGhpczMuc2FtcGxlc1BlclBpeGVsLCBfdGhpczMuc2FtcGxlUmF0ZSk7CiAgICAgICAgICByZXR1cm4gdHJhY2s7CiAgICAgICAgfSk7CiAgICAgICAgX3RoaXMzLnRyYWNrcyA9IF90aGlzMy50cmFja3MuY29uY2F0KHRyYWNrcyk7CiAgICAgICAgX3RoaXMzLmFkanVzdER1cmF0aW9uKCk7CiAgICAgICAgX3RoaXMzLmRyYXcoX3RoaXMzLnJlbmRlcigpKTsKICAgICAgICBfdGhpczMuZWUuZW1pdCgiYXVkaW9zb3VyY2VzcmVuZGVyZWQiKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBfdGhpczMuZWUuZW1pdCgiYXVkaW9zb3VyY2VzZXJyb3IiLCBlKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlVHJhY2tGcm9tU3BsaXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVRyYWNrRnJvbVNwbGl0KF9yZWYpIHsKICAgICAgdmFyIHRyYWNrVG9TcGxpdCA9IF9yZWYudHJhY2tUb1NwbGl0LAogICAgICAgIG5hbWUgPSBfcmVmLm5hbWUsCiAgICAgICAgc3BsaXRUaW1lID0gX3JlZi5zcGxpdFRpbWU7CiAgICAgIHZhciBlbmFibGVkU3RhdGVzID0gdHJhY2tUb1NwbGl0LmVuYWJsZWRTdGF0ZXM7CiAgICAgIHZhciBidWZmZXIgPSB0cmFja1RvU3BsaXQuYnVmZmVyOwogICAgICB2YXIgZmFkZU91dCA9IHRyYWNrVG9TcGxpdC5mYWRlT3V0OwogICAgICB2YXIgY3VlSW4gPSB0cmFja1RvU3BsaXQuY3VlSW47CiAgICAgIHZhciBjdWVPdXQgPSB0cmFja1RvU3BsaXQuY3VlT3V0OwogICAgICB2YXIgZ2FpbiA9IHRyYWNrVG9TcGxpdC5nYWluIHx8IDE7CiAgICAgIHZhciBtdXRlZCA9IGZhbHNlOwogICAgICBpZiAodGhpcy5tdXRlZFRyYWNrcy5pbmRleE9mKHRyYWNrVG9TcGxpdCkgIT09IC0xKSB7CiAgICAgICAgbXV0ZWQgPSB0cnVlOwogICAgICB9CiAgICAgIHZhciBzb2xvZWQgPSBmYWxzZTsKICAgICAgaWYgKHRoaXMuc29sb2VkVHJhY2tzLmluZGV4T2YodHJhY2tUb1NwbGl0KSAhPT0gLTEpIHsKICAgICAgICBzb2xvZWQgPSB0cnVlOwogICAgICB9CiAgICAgIHZhciBwZWFrcyA9IHRyYWNrVG9TcGxpdC5wZWFrRGF0YTsKICAgICAgdmFyIGN1c3RvbUNsYXNzID0gdHJhY2tUb1NwbGl0LmN1c3RvbUNsYXNzOwogICAgICB2YXIgd2F2ZU91dGxpbmVDb2xvciA9IHRyYWNrVG9TcGxpdC53YXZlT3V0bGluZUNvbG9yOwogICAgICB2YXIgc3RlcmVvUGFuID0gdHJhY2tUb1NwbGl0LnN0ZXJlb1BhbiB8fCAwOwogICAgICB2YXIgZWZmZWN0cyA9IHRyYWNrVG9TcGxpdC5lZmZlY3RzR3JhcGggfHwgbnVsbDsKCiAgICAgIC8vIHdlYmF1ZGlvIHNwZWNpZmljIHBsYXlvdXQgZm9yIG5vdy4KICAgICAgdmFyIHBsYXlvdXQgPSBuZXcgUGxheW91dCh0aGlzLmFjLCBidWZmZXIsIHRoaXMubWFzdGVyR2Fpbk5vZGUpOwogICAgICB2YXIgdHJhY2sgPSBuZXcgVHJhY2soKTsKICAgICAgdHJhY2suc3JjID0gdHJhY2tUb1NwbGl0LnNyYzsKICAgICAgdHJhY2suc2V0QnVmZmVyKGJ1ZmZlcik7CiAgICAgIHRyYWNrLnNldE5hbWUobmFtZSk7CiAgICAgIHRyYWNrLnNldEV2ZW50RW1pdHRlcih0aGlzLmVlKTsKICAgICAgdHJhY2suc2V0RW5hYmxlZFN0YXRlcyhlbmFibGVkU3RhdGVzKTsKICAgICAgdHJhY2suc2V0Q3VlcyhjdWVJbiwgY3VlT3V0KTsKICAgICAgdHJhY2suc2V0Q3VzdG9tQ2xhc3MoY3VzdG9tQ2xhc3MpOwogICAgICB0cmFjay5zZXRXYXZlT3V0bGluZUNvbG9yKHdhdmVPdXRsaW5lQ29sb3IpOwogICAgICBpZiAoZmFkZU91dCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFyIGZhZGUgPSB0cmFja1RvU3BsaXQuZmFkZXNbZmFkZU91dF07CiAgICAgICAgdHJhY2suc2V0RmFkZU91dChmYWRlLmVuZCAtIGZhZGUuc3RhcnQsIGZhZGUuc2hhcGUpOwogICAgICB9CiAgICAgIGlmIChwZWFrcyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdHJhY2suc2V0UGVha0RhdGEocGVha3MpOwogICAgICB9CiAgICAgIHRyYWNrLnNldFN0YXRlKHRoaXMuZ2V0U3RhdGUoKSk7CiAgICAgIHRyYWNrLnNldFBsYXlvdXQocGxheW91dCk7CiAgICAgIHRyYWNrLnNldEdhaW5MZXZlbChnYWluKTsKICAgICAgdHJhY2suc2V0U3RlcmVvUGFuVmFsdWUoc3RlcmVvUGFuKTsKICAgICAgaWYgKGVmZmVjdHMpIHsKICAgICAgICB0cmFjay5zZXRFZmZlY3RzKGVmZmVjdHMpOwogICAgICB9CiAgICAgIGlmIChtdXRlZCkgewogICAgICAgIHRoaXMubXV0ZVRyYWNrKHRyYWNrKTsKICAgICAgfQogICAgICBpZiAoc29sb2VkKSB7CiAgICAgICAgdGhpcy5zb2xvVHJhY2sodHJhY2spOwogICAgICB9CiAgICAgIHRyYWNrLnNldFN0YXJ0VGltZSh0cmFja1RvU3BsaXQuc3RhcnRUaW1lKTsKICAgICAgdHJhY2sudHJpbShzcGxpdFRpbWUsIHRyYWNrLmVuZFRpbWUpOwoKICAgICAgLy8gZXh0cmFjdCBwZWFrcyB3aXRoIEF1ZGlvQ29udGV4dCBmb3Igbm93LgogICAgICB0cmFjay5jYWxjdWxhdGVQZWFrcyh0aGlzLnNhbXBsZXNQZXJQaXhlbCwgdGhpcy5zYW1wbGVSYXRlKTsKICAgICAgdGhpcy50cmFja3MgPSB0aGlzLnRyYWNrcy5jb25jYXQoW3RyYWNrXSk7CiAgICAgIHRoaXMuYWRqdXN0RHVyYXRpb24oKTsKICAgICAgdGhpcy5kcmF3KHRoaXMucmVuZGVyKCkpOwogICAgICB0aGlzLnNldEFjdGl2ZVRyYWNrKHRyYWNrKTsKICAgICAgdGhpcy5lZS5lbWl0KCJhdWRpb3NvdXJjZXNyZW5kZXJlZCIpOwogICAgfQoKICAgIC8qDQogICAgICB0cmFjayBpbnN0YW5jZSBvZiBUcmFjay4NCiAgICAqLwogIH0sIHsKICAgIGtleTogInNldEFjdGl2ZVRyYWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRBY3RpdmVUcmFjayh0cmFjaykgewogICAgICB0aGlzLmFjdGl2ZVRyYWNrID0gdHJhY2s7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0QWN0aXZlVHJhY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFjdGl2ZVRyYWNrKCkgewogICAgICByZXR1cm4gdGhpcy5hY3RpdmVUcmFjazsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1NlZ21lbnRTZWxlY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzU2VnbWVudFNlbGVjdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMudGltZVNlbGVjdGlvbi5zdGFydCAhPT0gdGhpcy50aW1lU2VsZWN0aW9uLmVuZDsKICAgIH0KCiAgICAvKg0KICAgICAgc3RhcnQsIGVuZCBpbiBzZWNvbmRzLg0KICAgICovCiAgfSwgewogICAga2V5OiAic2V0VGltZVNlbGVjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGltZVNlbGVjdGlvbigpIHsKICAgICAgdmFyIHN0YXJ0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwogICAgICB2YXIgZW5kID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHRoaXMudGltZVNlbGVjdGlvbiA9IHsKICAgICAgICBzdGFydDogc3RhcnQsCiAgICAgICAgZW5kOiBlbmQgPT09IHVuZGVmaW5lZCA/IHN0YXJ0IDogZW5kCiAgICAgIH07CiAgICAgIHRoaXMuY3Vyc29yID0gc3RhcnQ7CiAgICB9CiAgfSwgewogICAga2V5OiAic3RhcnRPZmZsaW5lUmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc3RhcnRPZmZsaW5lUmVuZGVyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKHR5cGUpIHsKICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKICAgICAgICB2YXIgc2V0VXBDaGFpbiwgY3VycmVudFRpbWUsIG1nLCBhdWRpb0J1ZmZlcjsKICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNSZW5kZXJpbmcpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgdGhpcy5pc1JlbmRlcmluZyA9IHRydWU7CiAgICAgICAgICAgICAgdGhpcy5vZmZsaW5lQXVkaW9Db250ZXh0ID0gbmV3ICh3aW5kb3cuT2ZmbGluZUF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0T2ZmbGluZUF1ZGlvQ29udGV4dCkoMiwgNDgwMDAgKiB0aGlzLmR1cmF0aW9uLCA0ODAwMCk7CiAgICAgICAgICAgICAgc2V0VXBDaGFpbiA9IFtdOwogICAgICAgICAgICAgIHRoaXMuZWUuZW1pdCgiYXVkaW9yZW5kZXJpbmdzdGFydGluZyIsIHRoaXMub2ZmbGluZUF1ZGlvQ29udGV4dCwgc2V0VXBDaGFpbik7CiAgICAgICAgICAgICAgY3VycmVudFRpbWUgPSB0aGlzLm9mZmxpbmVBdWRpb0NvbnRleHQuY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgbWcgPSB0aGlzLm9mZmxpbmVBdWRpb0NvbnRleHQuY3JlYXRlR2FpbigpOwogICAgICAgICAgICAgIHRoaXMudHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7CiAgICAgICAgICAgICAgICB2YXIgcGxheW91dCA9IG5ldyBQbGF5b3V0KF90aGlzNC5vZmZsaW5lQXVkaW9Db250ZXh0LCB0cmFjay5idWZmZXIsIG1nKTsKICAgICAgICAgICAgICAgIHBsYXlvdXQuc2V0RWZmZWN0cyh0cmFjay5lZmZlY3RzR3JhcGgpOwogICAgICAgICAgICAgICAgcGxheW91dC5zZXRNYXN0ZXJFZmZlY3RzKF90aGlzNC5lZmZlY3RzR3JhcGgpOwogICAgICAgICAgICAgICAgdHJhY2suc2V0T2ZmbGluZVBsYXlvdXQocGxheW91dCk7CiAgICAgICAgICAgICAgICB0cmFjay5zY2hlZHVsZVBsYXkoY3VycmVudFRpbWUsIDAsIDAsIHsKICAgICAgICAgICAgICAgICAgc2hvdWxkUGxheTogX3RoaXM0LnNob3VsZFRyYWNrUGxheSh0cmFjayksCiAgICAgICAgICAgICAgICAgIG1hc3RlckdhaW46IDEsCiAgICAgICAgICAgICAgICAgIGlzT2ZmbGluZTogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgICAgVE9ETyBjbGVhbnVwIG9mIGRpZmZlcmVudCBhdWRpbyBwbGF5b3V0cyBoYW5kbGluZy4NCiAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHNldFVwQ2hhaW4pOwogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5vZmZsaW5lQXVkaW9Db250ZXh0LnN0YXJ0UmVuZGVyaW5nKCk7CiAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgYXVkaW9CdWZmZXIgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgIGlmIChbImJ1ZmZlciIsICJtcDMiLCAib3B1cyIsICJhYWMiXS5pbmNsdWRlcyh0eXBlKSkgewogICAgICAgICAgICAgICAgdGhpcy5lZS5lbWl0KCJhdWRpb3JlbmRlcmluZ2ZpbmlzaGVkIiwgdHlwZSwgYXVkaW9CdWZmZXIpOwogICAgICAgICAgICAgICAgdGhpcy5pc1JlbmRlcmluZyA9IGZhbHNlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gIndhdiIpIHsKICAgICAgICAgICAgICAgIHRoaXMuZXhwb3J0V29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgY29tbWFuZDogImluaXQiLAogICAgICAgICAgICAgICAgICBjb25maWc6IHsKICAgICAgICAgICAgICAgICAgICBzYW1wbGVSYXRlOiA0ODAwMAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyBjYWxsYmFjayBmb3IgYGV4cG9ydFdBVmAKICAgICAgICAgICAgICAgIHRoaXMuZXhwb3J0V29ya2VyLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNC5lZS5lbWl0KCJhdWRpb3JlbmRlcmluZ2ZpbmlzaGVkIiwgdHlwZSwgZS5kYXRhKTsKICAgICAgICAgICAgICAgICAgX3RoaXM0LmlzUmVuZGVyaW5nID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAvLyBjbGVhciBvdXQgdGhlIGJ1ZmZlciBmb3IgbmV4dCByZW5kZXJpbmdzLgogICAgICAgICAgICAgICAgICBfdGhpczQuZXhwb3J0V29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICBjb21tYW5kOiAiY2xlYXIiCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvLyBzZW5kIHRoZSBjaGFubmVsIGRhdGEgZnJvbSBvdXIgYnVmZmVyIHRvIHRoZSB3b3JrZXIKICAgICAgICAgICAgICAgIHRoaXMuZXhwb3J0V29ya2VyLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgY29tbWFuZDogInJlY29yZCIsCiAgICAgICAgICAgICAgICAgIGJ1ZmZlcjogW2F1ZGlvQnVmZmVyLmdldENoYW5uZWxEYXRhKDApLCBhdWRpb0J1ZmZlci5nZXRDaGFubmVsRGF0YSgxKV0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5leHBvcnRXb3JrZXIucG9zdE1lc3NhZ2UoewogICAgICAgICAgICAgICAgICBjb21tYW5kOiAiZXhwb3J0V0FWIiwKICAgICAgICAgICAgICAgICAgdHlwZTogImF1ZGlvL3dhdiIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CiAgICAgIGZ1bmN0aW9uIHN0YXJ0T2ZmbGluZVJlbmRlcihfeCkgewogICAgICAgIHJldHVybiBfc3RhcnRPZmZsaW5lUmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0YXJ0T2ZmbGluZVJlbmRlcjsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldFRpbWVTZWxlY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRpbWVTZWxlY3Rpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnRpbWVTZWxlY3Rpb247CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0U3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFN0YXRlKHN0YXRlKSB7CiAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTsKICAgICAgdGhpcy50cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICB0cmFjay5zZXRTdGF0ZShzdGF0ZSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdGF0ZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Wm9vbUluZGV4IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRab29tSW5kZXgoaW5kZXgpIHsKICAgICAgdGhpcy56b29tSW5kZXggPSBpbmRleDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRab29tTGV2ZWxzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRab29tTGV2ZWxzKGxldmVscykgewogICAgICB0aGlzLnpvb21MZXZlbHMgPSBsZXZlbHM7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Wm9vbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Wm9vbSh6b29tKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwogICAgICB0aGlzLnNhbXBsZXNQZXJQaXhlbCA9IHpvb207CiAgICAgIHRoaXMuem9vbUluZGV4ID0gdGhpcy56b29tTGV2ZWxzLmluZGV4T2Yoem9vbSk7CiAgICAgIHRoaXMudHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7CiAgICAgICAgdHJhY2suY2FsY3VsYXRlUGVha3Moem9vbSwgX3RoaXM1LnNhbXBsZVJhdGUpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtdXRlVHJhY2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIG11dGVUcmFjayh0cmFjaykgewogICAgICB2YXIgaW5kZXggPSB0aGlzLm11dGVkVHJhY2tzLmluZGV4T2YodHJhY2spOwogICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgIHRoaXMubXV0ZWRUcmFja3Muc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm11dGVkVHJhY2tzLnB1c2godHJhY2spOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic29sb1RyYWNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzb2xvVHJhY2sodHJhY2spIHsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5zb2xvZWRUcmFja3MuaW5kZXhPZih0cmFjayk7CiAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgdGhpcy5zb2xvZWRUcmFja3Muc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmV4Y2xTb2xvKSB7CiAgICAgICAgdGhpcy5zb2xvZWRUcmFja3MgPSBbdHJhY2tdOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc29sb2VkVHJhY2tzLnB1c2godHJhY2spOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY29sbGFwc2VUcmFjayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29sbGFwc2VUcmFjayh0cmFjaywgb3B0cykgewogICAgICBpZiAob3B0cy5jb2xsYXBzZWQpIHsKICAgICAgICB0aGlzLmNvbGxhcHNlZFRyYWNrcy5wdXNoKHRyYWNrKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmNvbGxhcHNlZFRyYWNrcy5pbmRleE9mKHRyYWNrKTsKICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgdGhpcy5jb2xsYXBzZWRUcmFja3Muc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVUcmFjayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlVHJhY2sodHJhY2spIHsKICAgICAgaWYgKHRyYWNrLmlzUGxheWluZygpKSB7CiAgICAgICAgdHJhY2suc2NoZWR1bGVTdG9wKCk7CiAgICAgIH0KICAgICAgdmFyIHRyYWNrTGlzdHMgPSBbdGhpcy5tdXRlZFRyYWNrcywgdGhpcy5zb2xvZWRUcmFja3MsIHRoaXMuY29sbGFwc2VkVHJhY2tzLCB0aGlzLnRyYWNrc107CiAgICAgIHRyYWNrTGlzdHMuZm9yRWFjaChmdW5jdGlvbiAobGlzdCkgewogICAgICAgIHZhciBpbmRleCA9IGxpc3QuaW5kZXhPZih0cmFjayk7CiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgIGxpc3Quc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmFkanVzdER1cmF0aW9uKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYWRqdXN0VHJhY2tQbGF5b3V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGp1c3RUcmFja1BsYXlvdXQoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwogICAgICB0aGlzLnRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykgewogICAgICAgIHRyYWNrLnNldFNob3VsZFBsYXkoX3RoaXM2LnNob3VsZFRyYWNrUGxheSh0cmFjaykpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGp1c3REdXJhdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRqdXN0RHVyYXRpb24oKSB7CiAgICAgIHRoaXMuZHVyYXRpb24gPSB0aGlzLnRyYWNrcy5yZWR1Y2UoZnVuY3Rpb24gKGR1cmF0aW9uLCB0cmFjaykgewogICAgICAgIHJldHVybiBNYXRoLm1heChkdXJhdGlvbiwgdHJhY2suZ2V0RW5kVGltZSgpKTsKICAgICAgfSwgMCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvdWxkVHJhY2tQbGF5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG91bGRUcmFja1BsYXkodHJhY2spIHsKICAgICAgdmFyIHNob3VsZFBsYXk7CiAgICAgIC8vIGlmIHRoZXJlIGFyZSBzb2xvIHRyYWNrcywgb25seSB0aGV5IHNob3VsZCBwbGF5LgogICAgICBpZiAodGhpcy5zb2xvZWRUcmFja3MubGVuZ3RoID4gMCkgewogICAgICAgIHNob3VsZFBsYXkgPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy5zb2xvZWRUcmFja3MuaW5kZXhPZih0cmFjaykgPiAtMSkgewogICAgICAgICAgc2hvdWxkUGxheSA9IHRydWU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIHBsYXkgYWxsIHRyYWNrcyBleGNlcHQgYW55IG11dGVkIHRyYWNrcy4KICAgICAgICBzaG91bGRQbGF5ID0gdHJ1ZTsKICAgICAgICBpZiAodGhpcy5tdXRlZFRyYWNrcy5pbmRleE9mKHRyYWNrKSA+IC0xKSB7CiAgICAgICAgICBzaG91bGRQbGF5ID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBzaG91bGRQbGF5OwogICAgfQogIH0sIHsKICAgIGtleTogImlzUGxheWluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNQbGF5aW5nKCkgewogICAgICByZXR1cm4gdGhpcy50cmFja3MucmVkdWNlKGZ1bmN0aW9uIChpc1BsYXlpbmcsIHRyYWNrKSB7CiAgICAgICAgcmV0dXJuIGlzUGxheWluZyB8fCB0cmFjay5pc1BsYXlpbmcoKTsKICAgICAgfSwgZmFsc2UpOwogICAgfQoKICAgIC8qDQogICAgICogICByZXR1cm5zIHRoZSBjdXJyZW50IHBvaW50IG9mIHRpbWUgaW4gdGhlIHBsYXlsaXN0IGluIHNlY29uZHMuDQogICAgICovCiAgfSwgewogICAga2V5OiAiZ2V0Q3VycmVudFRpbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEN1cnJlbnRUaW1lKCkgewogICAgICB2YXIgY3Vyc29yUG9zID0gdGhpcy5sYXN0U2Vla2VkIHx8IHRoaXMucGF1c2VkQXQgfHwgdGhpcy5jdXJzb3I7CiAgICAgIHJldHVybiBjdXJzb3JQb3MgKyB0aGlzLmdldEVsYXBzZWRUaW1lKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RWxhcHNlZFRpbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVsYXBzZWRUaW1lKCkgewogICAgICByZXR1cm4gdGhpcy5hYy5jdXJyZW50VGltZSAtIHRoaXMubGFzdFBsYXk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TWFzdGVyR2FpbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TWFzdGVyR2FpbihnYWluKSB7CiAgICAgIHRoaXMuZWUuZW1pdCgibWFzdGVydm9sdW1lY2hhbmdlIiwgZ2Fpbik7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVzdGFydFBsYXlGcm9tIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXN0YXJ0UGxheUZyb20oc3RhcnQsIGVuZCkgewogICAgICB0aGlzLnN0b3BBbmltYXRpb24oKTsKICAgICAgdGhpcy50cmFja3MuZm9yRWFjaChmdW5jdGlvbiAoZWRpdG9yKSB7CiAgICAgICAgZWRpdG9yLnNjaGVkdWxlU3RvcCgpOwogICAgICB9KTsKICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHRoaXMucGxheW91dFByb21pc2VzKS50aGVuKHRoaXMucGxheS5iaW5kKHRoaXMsIHN0YXJ0LCBlbmQpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwbGF5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwbGF5KHN0YXJ0VGltZSwgZW5kVGltZSkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVzZXREcmF3VGltZXIpOwogICAgICB2YXIgY3VycmVudFRpbWUgPSB0aGlzLmFjLmN1cnJlbnRUaW1lOwogICAgICB2YXIgc2VsZWN0ZWQgPSB0aGlzLmdldFRpbWVTZWxlY3Rpb24oKTsKICAgICAgdmFyIHBsYXlvdXRQcm9taXNlcyA9IFtdOwogICAgICB2YXIgc3RhcnQgPSBzdGFydFRpbWUgPT09IDAgPyAwIDogc3RhcnRUaW1lIHx8IHRoaXMucGF1c2VkQXQgfHwgdGhpcy5jdXJzb3I7CiAgICAgIHZhciBlbmQgPSBlbmRUaW1lOwogICAgICBpZiAoIWVuZCAmJiBzZWxlY3RlZC5lbmQgIT09IHNlbGVjdGVkLnN0YXJ0ICYmIHNlbGVjdGVkLmVuZCA+IHN0YXJ0KSB7CiAgICAgICAgZW5kID0gc2VsZWN0ZWQuZW5kOwogICAgICB9CiAgICAgIGlmICh0aGlzLmlzUGxheWluZygpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucmVzdGFydFBsYXlGcm9tKHN0YXJ0LCBlbmQpOwogICAgICB9CgogICAgICAvLyBUT0RPIHJlZmVjdG9yIHRoaXMgaW4gdXBjb21pbmcgbW9kZXJuaXNhdGlvbi4KICAgICAgaWYgKHRoaXMuZWZmZWN0c0dyYXBoKSB0aGlzLnRyYWNrcyAmJiB0aGlzLnRyYWNrc1swXS5wbGF5b3V0LnNldE1hc3RlckVmZmVjdHModGhpcy5lZmZlY3RzR3JhcGgpOwogICAgICB0aGlzLnRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykgewogICAgICAgIHRyYWNrLnNldFN0YXRlKCJjdXJzb3IiKTsKICAgICAgICBwbGF5b3V0UHJvbWlzZXMucHVzaCh0cmFjay5zY2hlZHVsZVBsYXkoY3VycmVudFRpbWUsIHN0YXJ0LCBlbmQsIHsKICAgICAgICAgIHNob3VsZFBsYXk6IF90aGlzNy5zaG91bGRUcmFja1BsYXkodHJhY2spLAogICAgICAgICAgbWFzdGVyR2FpbjogX3RoaXM3Lm1hc3RlckdhaW4KICAgICAgICB9KSk7CiAgICAgIH0pOwogICAgICB0aGlzLmxhc3RQbGF5ID0gY3VycmVudFRpbWU7CiAgICAgIC8vIHVzZSB0aGVzZSB0byB0cmFjayB3aGVuIHRoZSBwbGF5bGlzdCBoYXMgZnVsbHkgc3RvcHBlZC4KICAgICAgdGhpcy5wbGF5b3V0UHJvbWlzZXMgPSBwbGF5b3V0UHJvbWlzZXM7CiAgICAgIHRoaXMuc3RhcnRBbmltYXRpb24oc3RhcnQpOwogICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5wbGF5b3V0UHJvbWlzZXMpOwogICAgfQogIH0sIHsKICAgIGtleTogInBhdXNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwYXVzZSgpIHsKICAgICAgLy8gY29uc29sZS5sb2coInBhdXNlXG4iKTsKCiAgICAgIGlmICghdGhpcy5pc1BsYXlpbmcoKSAmJiB0aGlzLm1lZGlhUmVjb3JkZXIpIHsKICAgICAgICBpZiAodGhpcy5tZWRpYVJlY29yZGVyLnN0YXRlID09PSAicmVjb3JkaW5nIikgewogICAgICAgICAgLy8gY29uc29sZS5sb2coIm1lZGlhIHJlY29yZGVyIHBhdXNlXG4iKTsKICAgICAgICAgIHRoaXMubWVkaWFSZWNvcmRlci5wYXVzZSgpOwogICAgICAgICAgdGhpcy5wYXVzZWRBdCA9IHRoaXMuZ2V0Q3VycmVudFRpbWUoKTsKICAgICAgICAgIHJldHVybiB0aGlzLnBsYXliYWNrUmVzZXQoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMubWVkaWFSZWNvcmRlci5zdGF0ZSA9PT0gInBhdXNlZCIpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJtZWRpYSByZWNvcmRlciByZXN1bWVcbiIpOwogICAgICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnJlc3VtZSgpOwogICAgICAgICAgcmV0dXJuIHRoaXMucGxheWJhY2tSZXNldCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodGhpcy5wbGF5b3V0UHJvbWlzZXMpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmlzUGxheWluZygpKSB7CiAgICAgICAgdGhpcy5wYXVzZWRBdCA9IHRoaXMuZ2V0Q3VycmVudFRpbWUoKTsKICAgICAgICByZXR1cm4gdGhpcy5wbGF5YmFja1Jlc2V0KCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdG9wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzdG9wKCkgewogICAgICBpZiAodGhpcy5tZWRpYVJlY29yZGVyICYmICh0aGlzLm1lZGlhUmVjb3JkZXIuc3RhdGUgPT09ICJyZWNvcmRpbmciIHx8IHRoaXMubWVkaWFSZWNvcmRlci5zdGF0ZSA9PT0gInBhdXNlZCIpKSB7CiAgICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnN0b3AoKTsKICAgICAgfQogICAgICB0aGlzLnBhdXNlZEF0ID0gdW5kZWZpbmVkOwogICAgICB0aGlzLnBsYXliYWNrU2Vjb25kcyA9IDA7CiAgICAgIHJldHVybiB0aGlzLnBsYXliYWNrUmVzZXQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwbGF5YmFja1Jlc2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwbGF5YmFja1Jlc2V0KCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKICAgICAgdGhpcy5sYXN0U2Vla2VkID0gdW5kZWZpbmVkOwogICAgICB0aGlzLnN0b3BBbmltYXRpb24oKTsKICAgICAgdGhpcy50cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICB0cmFjay5zY2hlZHVsZVN0b3AoKTsKICAgICAgICB0cmFjay5zZXRTdGF0ZShfdGhpczguZ2V0U3RhdGUoKSk7CiAgICAgIH0pOwoKICAgICAgLy8gVE9ETyBpbXByb3ZlIHRoaXMuCiAgICAgIHRoaXMubWFzdGVyR2Fpbk5vZGUuZGlzY29ubmVjdCgpOwogICAgICB0aGlzLmRyYXdSZXF1ZXN0KCk7CiAgICAgIHJldHVybiBQcm9taXNlLmFsbCh0aGlzLnBsYXlvdXRQcm9taXNlcyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmV3aW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXdpbmQoKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwogICAgICByZXR1cm4gdGhpcy5zdG9wKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM5LnNjcm9sbExlZnQgPSAwOwogICAgICAgIF90aGlzOS5lZS5lbWl0KCJzZWxlY3QiLCAwLCAwKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZmFzdEZvcndhcmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZhc3RGb3J3YXJkKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzLnN0b3AoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMxMC52aWV3RHVyYXRpb24gPCBfdGhpczEwLmR1cmF0aW9uKSB7CiAgICAgICAgICBfdGhpczEwLnNjcm9sbExlZnQgPSBfdGhpczEwLmR1cmF0aW9uIC0gX3RoaXMxMC52aWV3RHVyYXRpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIF90aGlzMTAuc2Nyb2xsTGVmdCA9IDA7CiAgICAgICAgfQogICAgICAgIF90aGlzMTAuZWUuZW1pdCgic2VsZWN0IiwgX3RoaXMxMC5kdXJhdGlvbiwgX3RoaXMxMC5kdXJhdGlvbik7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNsZWFyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhcigpIHsKICAgICAgdmFyIF90aGlzMTEgPSB0aGlzOwogICAgICByZXR1cm4gdGhpcy5zdG9wKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMS50cmFja3MgPSBbXTsKICAgICAgICBfdGhpczExLnNvbG9lZFRyYWNrcyA9IFtdOwogICAgICAgIF90aGlzMTEubXV0ZWRUcmFja3MgPSBbXTsKICAgICAgICBfdGhpczExLnBsYXlvdXRQcm9taXNlcyA9IFtdOwogICAgICAgIF90aGlzMTEuY3Vyc29yID0gMDsKICAgICAgICBfdGhpczExLnBsYXliYWNrU2Vjb25kcyA9IDA7CiAgICAgICAgX3RoaXMxMS5kdXJhdGlvbiA9IDA7CiAgICAgICAgX3RoaXMxMS5zY3JvbGxMZWZ0ID0gMDsKICAgICAgICBfdGhpczExLnNlZWsoMCwgMCwgdW5kZWZpbmVkKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVjb3JkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWNvcmQoKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKICAgICAgdmFyIHBsYXlvdXRQcm9taXNlcyA9IFtdOwogICAgICB2YXIgc3RhcnQgPSB0aGlzLmN1cnNvcjsKICAgICAgaWYgKCF0aGlzLmlzUGxheWluZygpICYmIHRoaXMubWVkaWFSZWNvcmRlciAmJiB0aGlzLm1lZGlhUmVjb3JkZXIuc3RhdGUgPT09ICJwYXVzZWQiKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coIm1lZGlhIHJlY29yZGVyIHJlc3VtZVxuIik7CiAgICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnJlc3VtZSgpOwogICAgICB9CiAgICAgIGlmICghdGhpcy5pc1BsYXlpbmcoKSAmJiB0aGlzLm1lZGlhUmVjb3JkZXIgJiYgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXRlICE9PSAicmVjb3JkaW5nIiAmJiB0aGlzLm1lZGlhUmVjb3JkZXIuc3RhdGUgIT09ICJwYXVzZWQiKSB7CiAgICAgICAgdGhpcy5tZWRpYVJlY29yZGVyLnN0YXJ0KDMwMCk7CiAgICAgICAgdGhpcy50cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICAgIHRyYWNrLnNldFN0YXRlKCJub25lIik7CiAgICAgICAgICBwbGF5b3V0UHJvbWlzZXMucHVzaCh0cmFjay5zY2hlZHVsZVBsYXkoX3RoaXMxMi5hYy5jdXJyZW50VGltZSwgc3RhcnQsIHVuZGVmaW5lZCwgewogICAgICAgICAgICBzaG91bGRQbGF5OiBfdGhpczEyLnNob3VsZFRyYWNrUGxheSh0cmFjaykKICAgICAgICAgIH0pKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnBsYXlvdXRQcm9taXNlcyA9IHBsYXlvdXRQcm9taXNlczsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInN0YXJ0QW5pbWF0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzdGFydEFuaW1hdGlvbihzdGFydFRpbWUpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwogICAgICB0aGlzLmxhc3REcmF3ID0gdGhpcy5hYy5jdXJyZW50VGltZTsKICAgICAgdGhpcy5hbmltYXRpb25SZXF1ZXN0ID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMy51cGRhdGVFZGl0b3Ioc3RhcnRUaW1lKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic3RvcEFuaW1hdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3RvcEFuaW1hdGlvbigpIHsKICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuYW5pbWF0aW9uUmVxdWVzdCk7CiAgICAgIHRoaXMubGFzdERyYXcgPSB1bmRlZmluZWQ7CiAgICB9CiAgfSwgewogICAga2V5OiAic2VlayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2VlayhzdGFydCwgZW5kLCB0cmFjaykgewogICAgICBpZiAodGhpcy5pc1BsYXlpbmcoKSkgewogICAgICAgIHRoaXMubGFzdFNlZWtlZCA9IHN0YXJ0OwogICAgICAgIHRoaXMucGF1c2VkQXQgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5yZXN0YXJ0UGxheUZyb20oc3RhcnQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHJlc2V0IGlmIGl0IHdhcyBwYXVzZWQuCiAgICAgICAgdGhpcy5zZXRBY3RpdmVUcmFjayh0cmFjayB8fCB0aGlzLnRyYWNrc1swXSk7CiAgICAgICAgdGhpcy5wYXVzZWRBdCA9IHN0YXJ0OwogICAgICAgIHRoaXMuc2V0VGltZVNlbGVjdGlvbihzdGFydCwgZW5kKTsKICAgICAgICBpZiAodGhpcy5nZXRTZWVrU3R5bGUoKSA9PT0gImZpbGwiKSB7CiAgICAgICAgICB0aGlzLnBsYXliYWNrU2Vjb25kcyA9IHN0YXJ0OwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIC8qDQogICAgICogQW5pbWF0aW9uIGZ1bmN0aW9uIGZvciB0aGUgcGxheWxpc3QuDQogICAgICogS2VlcCB1bmRlciAxNi43IG1pbGxpc2Vjb25kcyBiYXNlZCBvbiBhIHR5cGljYWwgc2NyZWVuIHJlZnJlc2ggcmF0ZSBvZiA2MGZwcy4NCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJ1cGRhdGVFZGl0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUVkaXRvcihjdXJzb3IpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwogICAgICB2YXIgY3VycmVudFRpbWUgPSB0aGlzLmFjLmN1cnJlbnRUaW1lOwogICAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy5nZXRUaW1lU2VsZWN0aW9uKCk7CiAgICAgIHZhciBjdXJzb3JQb3MgPSBjdXJzb3IgfHwgdGhpcy5jdXJzb3I7CiAgICAgIHZhciBlbGFwc2VkID0gY3VycmVudFRpbWUgLSB0aGlzLmxhc3REcmF3OwogICAgICBpZiAodGhpcy5pc1BsYXlpbmcoKSkgewogICAgICAgIHZhciBwbGF5YmFja1NlY29uZHMgPSBjdXJzb3JQb3MgKyBlbGFwc2VkOwogICAgICAgIHRoaXMuZWUuZW1pdCgidGltZXVwZGF0ZSIsIHBsYXliYWNrU2Vjb25kcyk7CiAgICAgICAgdGhpcy5hbmltYXRpb25SZXF1ZXN0ID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczE0LnVwZGF0ZUVkaXRvcihwbGF5YmFja1NlY29uZHMpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMucGxheWJhY2tTZWNvbmRzID0gcGxheWJhY2tTZWNvbmRzOwogICAgICAgIHRoaXMuZHJhdyh0aGlzLnJlbmRlcigpKTsKICAgICAgICB0aGlzLmxhc3REcmF3ID0gY3VycmVudFRpbWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGN1cnNvclBvcyArIGVsYXBzZWQgPj0gKHRoaXMuaXNTZWdtZW50U2VsZWN0aW9uKCkgPyBzZWxlY3Rpb24uZW5kIDogdGhpcy5kdXJhdGlvbikpIHsKICAgICAgICAgIHRoaXMuZWUuZW1pdCgiZmluaXNoZWQiKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zdG9wQW5pbWF0aW9uKCk7CiAgICAgICAgdGhpcy5yZXNldERyYXdUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMxNC5wYXVzZWRBdCA9IHVuZGVmaW5lZDsKICAgICAgICAgIF90aGlzMTQubGFzdFNlZWtlZCA9IHVuZGVmaW5lZDsKICAgICAgICAgIF90aGlzMTQuc2V0U3RhdGUoX3RoaXMxNC5nZXRTdGF0ZSgpKTsKICAgICAgICAgIF90aGlzMTQucGxheWJhY2tTZWNvbmRzID0gMDsKICAgICAgICAgIF90aGlzMTQuZHJhdyhfdGhpczE0LnJlbmRlcigpKTsKICAgICAgICB9LCAwKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImRyYXdSZXF1ZXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3UmVxdWVzdCgpIHsKICAgICAgdmFyIF90aGlzMTUgPSB0aGlzOwogICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczE1LmRyYXcoX3RoaXMxNS5yZW5kZXIoKSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImRyYXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRyYXcobmV3VHJlZSkgewogICAgICB2YXIgcGF0Y2hlcyA9IGRpZmYodGhpcy50cmVlLCBuZXdUcmVlKTsKICAgICAgdGhpcy5yb290Tm9kZSA9IHBhdGNoKHRoaXMucm9vdE5vZGUsIHBhdGNoZXMpOwogICAgICB0aGlzLnRyZWUgPSBuZXdUcmVlOwoKICAgICAgLy8gdXNlIGZvciBmYXN0IGZvcndhcmRpbmcuCiAgICAgIHRoaXMudmlld0R1cmF0aW9uID0gcGl4ZWxzVG9TZWNvbmRzKHRoaXMucm9vdE5vZGUuY2xpZW50V2lkdGggLSB0aGlzLmNvbnRyb2xzLndpZHRoLCB0aGlzLnNhbXBsZXNQZXJQaXhlbCwgdGhpcy5zYW1wbGVSYXRlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRUcmFja1JlbmRlckRhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRyYWNrUmVuZGVyRGF0YSgpIHsKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgaGVpZ2h0OiB0aGlzLndhdmVIZWlnaHQsCiAgICAgICAgcmVzb2x1dGlvbjogdGhpcy5zYW1wbGVzUGVyUGl4ZWwsCiAgICAgICAgc2FtcGxlUmF0ZTogdGhpcy5zYW1wbGVSYXRlLAogICAgICAgIGNvbnRyb2xzOiB0aGlzLmNvbnRyb2xzLAogICAgICAgIGlzQWN0aXZlOiBmYWxzZSwKICAgICAgICB0aW1lU2VsZWN0aW9uOiB0aGlzLmdldFRpbWVTZWxlY3Rpb24oKSwKICAgICAgICBwbGF5bGlzdExlbmd0aDogdGhpcy5kdXJhdGlvbiwKICAgICAgICBwbGF5YmFja1NlY29uZHM6IHRoaXMucGxheWJhY2tTZWNvbmRzLAogICAgICAgIGNvbG9yczogdGhpcy5jb2xvcnMsCiAgICAgICAgYmFyV2lkdGg6IHRoaXMuYmFyV2lkdGgsCiAgICAgICAgYmFyR2FwOiB0aGlzLmJhckdhcAogICAgICB9OwogICAgICByZXR1cm4gX2RlZmF1bHRzKHt9LCBkYXRhLCBkZWZhdWx0cyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNBY3RpdmVUcmFjayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNBY3RpdmVUcmFjayh0cmFjaykgewogICAgICB2YXIgYWN0aXZlVHJhY2sgPSB0aGlzLmdldEFjdGl2ZVRyYWNrKCk7CiAgICAgIGlmICh0aGlzLmlzU2VnbWVudFNlbGVjdGlvbigpKSB7CiAgICAgICAgcmV0dXJuIGFjdGl2ZVRyYWNrID09PSB0cmFjazsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJBbm5vdGF0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyQW5ub3RhdGlvbnMoKSB7CiAgICAgIHJldHVybiB0aGlzLmFubm90YXRpb25MaXN0LnJlbmRlcigpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlclRpbWVTY2FsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyVGltZVNjYWxlKCkgewogICAgICB2YXIgY29udHJvbFdpZHRoID0gdGhpcy5jb250cm9scy5zaG93ID8gdGhpcy5jb250cm9scy53aWR0aCA6IDA7CiAgICAgIHZhciB0aW1lU2NhbGUgPSBuZXcgVGltZVNjYWxlKHRoaXMuZHVyYXRpb24sIHRoaXMuc2Nyb2xsTGVmdCwgdGhpcy5zYW1wbGVzUGVyUGl4ZWwsIHRoaXMuc2FtcGxlUmF0ZSwgY29udHJvbFdpZHRoLCB0aGlzLmNvbG9ycyk7CiAgICAgIHJldHVybiB0aW1lU2NhbGUucmVuZGVyKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyVHJhY2tTZWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJUcmFja1NlY3Rpb24oKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKICAgICAgdmFyIHRyYWNrRWxlbWVudHMgPSB0aGlzLnRyYWNrcy5tYXAoZnVuY3Rpb24gKHRyYWNrKSB7CiAgICAgICAgdmFyIGNvbGxhcHNlZCA9IF90aGlzMTYuY29sbGFwc2VkVHJhY2tzLmluZGV4T2YodHJhY2spID4gLTE7CiAgICAgICAgcmV0dXJuIHRyYWNrLnJlbmRlcihfdGhpczE2LmdldFRyYWNrUmVuZGVyRGF0YSh7CiAgICAgICAgICBpc0FjdGl2ZTogX3RoaXMxNi5pc0FjdGl2ZVRyYWNrKHRyYWNrKSwKICAgICAgICAgIHNob3VsZFBsYXk6IF90aGlzMTYuc2hvdWxkVHJhY2tQbGF5KHRyYWNrKSwKICAgICAgICAgIHNvbG9lZDogX3RoaXMxNi5zb2xvZWRUcmFja3MuaW5kZXhPZih0cmFjaykgPiAtMSwKICAgICAgICAgIG11dGVkOiBfdGhpczE2Lm11dGVkVHJhY2tzLmluZGV4T2YodHJhY2spID4gLTEsCiAgICAgICAgICBjb2xsYXBzZWQ6IGNvbGxhcHNlZCwKICAgICAgICAgIGhlaWdodDogY29sbGFwc2VkID8gX3RoaXMxNi5jb2xsYXBzZWRXYXZlSGVpZ2h0IDogX3RoaXMxNi53YXZlSGVpZ2h0LAogICAgICAgICAgYmFyR2FwOiBfdGhpczE2LmJhckdhcCwKICAgICAgICAgIGJhcldpZHRoOiBfdGhpczE2LmJhcldpZHRoCiAgICAgICAgfSkpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGgoImRpdi5wbGF5bGlzdC10cmFja3MiLCB7CiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc3R5bGU6ICJvdmVyZmxvdzogYXV0bzsiCiAgICAgICAgfSwKICAgICAgICBvbnNjcm9sbDogZnVuY3Rpb24gb25zY3JvbGwoZSkgewogICAgICAgICAgX3RoaXMxNi5zY3JvbGxMZWZ0ID0gcGl4ZWxzVG9TZWNvbmRzKGUudGFyZ2V0LnNjcm9sbExlZnQsIF90aGlzMTYuc2FtcGxlc1BlclBpeGVsLCBfdGhpczE2LnNhbXBsZVJhdGUpOwogICAgICAgICAgX3RoaXMxNi5lZS5lbWl0KCJzY3JvbGwiKTsKICAgICAgICB9LAogICAgICAgIGhvb2s6IG5ldyBTY3JvbGxIb29rKHRoaXMpCiAgICAgIH0sIHRyYWNrRWxlbWVudHMpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgY29udGFpbmVyQ2hpbGRyZW4gPSBbXTsKICAgICAgaWYgKHRoaXMuc2hvd1RpbWVzY2FsZSkgewogICAgICAgIGNvbnRhaW5lckNoaWxkcmVuLnB1c2godGhpcy5yZW5kZXJUaW1lU2NhbGUoKSk7CiAgICAgIH0KICAgICAgY29udGFpbmVyQ2hpbGRyZW4ucHVzaCh0aGlzLnJlbmRlclRyYWNrU2VjdGlvbigpKTsKICAgICAgaWYgKHRoaXMuYW5ub3RhdGlvbkxpc3QubGVuZ3RoKSB7CiAgICAgICAgY29udGFpbmVyQ2hpbGRyZW4ucHVzaCh0aGlzLnJlbmRlckFubm90YXRpb25zKCkpOwogICAgICB9CiAgICAgIHJldHVybiBoKCJkaXYucGxheWxpc3QiLCB7CiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc3R5bGU6ICJvdmVyZmxvdzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRpdmU7IgogICAgICAgIH0KICAgICAgfSwgY29udGFpbmVyQ2hpbGRyZW4pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEluZm8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEluZm8oKSB7CiAgICAgIHZhciB0cmFja3MgPSBbXTsKICAgICAgdGhpcy50cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICB0cmFja3MucHVzaCh0cmFjay5nZXRUcmFja0RldGFpbHMoKSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIHRyYWNrczogdHJhY2tzLAogICAgICAgIGVmZmVjdHM6IHRoaXMuZWZmZWN0c0dyYXBoCiAgICAgIH07CiAgICB9CgogICAgLy8tLS0tLS0tLS0tLSBIRVJUWkpTIC0tLS0tLS0tLS0tLS0tCgogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIGJ5IHRoZSBldmVudCBsaXN0ZW5lci4NCiAgICAgKiBUaGlzIG1ldGhvZCBzeW5jcyB0aGUgaGVydHpqcyBwcm9qZWN0IHRvIHRoZSBjdXJyZW50IHdhdmVmb3JtIHByb2plY3QuDQogICAgICogSGVydGp6IHN1cHBvcnRzIG11bHRpcGxlIGNsaXBzIHBlciB0cmFjaywgaG93ZXZlciB3YXZlZm9ybSBkb2VzIG5vdCwgYW5kIGZvciB0aGF0LCBlYWNoIGhlcnR6anMgY2xpcA0KICAgICAqIHdpbGwgYmUgc3RvcmVkIGluIGEgc2VwYXJhdGUgd2F2ZWZvcm0gdHJhY2suDQogICAgICovCiAgfSwgewogICAga2V5OiAiY29weUZyb21IZXJ0empzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY29weUZyb21IZXJ0empzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhoZXJ0anpQcm9qZWN0KSB7CiAgICAgICAgdmFyIF90aGlzMTcgPSB0aGlzOwogICAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnRyYWNrcyA9IFtdOwogICAgICAgICAgICAgIGhlcnRqelByb2plY3QudHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKGhlcnR6anNUcmFjaykgewogICAgICAgICAgICAgICAgaGVydHpqc1RyYWNrLmNsaXBzLmZvckVhY2goIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoaGVydGp6Q2xpcCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0cmFjazsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgLy9DcmVhdGUgYSBuZXcgd2F2ZWZvcm0gdHJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdOSURIQUwtTE9HOnN5bmNXaXRoSGVydGpzLTEnLCBoZXJ0anpDbGlwLnBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2sgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcmM6IGhlcnRqekNsaXAucGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGhlcnRqekNsaXAucGF0aC5pbmNsdWRlcygnLycpID8gaGVydGp6Q2xpcC5wYXRoLm1hdGNoKC9cLyhbXi9dKykkLylbMV0gOiBoZXJ0anpDbGlwLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogaGVydGp6Q2xpcC5zdGFydHNBdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ZWluOiBoZXJ0anpDbGlwLm9mZnNldCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ZW91dDogaGVydGp6Q2xpcC5kdXJhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgIH07IC8vQWRkIGVmZmVjdHMKICAgICAgICAgICAgICAgICAgICAgICAgICBoZXJ0anpDbGlwLmVmZmVjdHMuZm9yRWFjaChmdW5jdGlvbiAoaGVydHpqc0VmZmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChoZXJ0empzRWZmZWN0Lm5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZmFkZS1pbic6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhlcnR6anNFZmZlY3QucGFyYW1zICYmIGhlcnR6anNFZmZlY3QucGFyYW1zLmR1cmF0aW9uID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2suZmFkZUluID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogaGVydHpqc0VmZmVjdC5wYXJhbXMuZHVyYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdmYWRlLW91dCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhlcnR6anNFZmZlY3QucGFyYW1zICYmIGhlcnR6anNFZmZlY3QucGFyYW1zLmR1cmF0aW9uID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2suZmFkZU91dCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IGhlcnR6anNFZmZlY3QucGFyYW1zLmR1cmF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczE3LmxvYWQoW3RyYWNrXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnRyYWNrcykKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94MykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwogICAgICBmdW5jdGlvbiBjb3B5RnJvbUhlcnR6anMoX3gyKSB7CiAgICAgICAgcmV0dXJuIF9jb3B5RnJvbUhlcnR6anMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgICByZXR1cm4gY29weUZyb21IZXJ0empzOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiY29tbWl0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21taXQoKSB7CiAgICAgIHZhciBfdGhpczE4ID0gdGhpczsKICAgICAgaWYgKCF0aGlzLmhlcnR6anNQcm9qZWN0KSB7CiAgICAgICAgdGhpcy5oZXJ0empzUHJvamVjdCA9IG5ldyBBdWRpb1Byb2plY3QoKTsKICAgICAgICAvL2NvbnNvbGUubG9nKCdDcmVhdGluZyBhIG5ldyBIZXJ0empzIEluc3RhbmNlJykKICAgICAgfQogICAgICB3aW5kb3cuaGp6ID0gdGhpcy5oZXJ0empzUHJvamVjdDsKICAgICAgLy9Db3B5IGFsbCB0aGUgd2F2ZWZvcm0gc2V0dGluZ3MgdG8gaGVydHpqcyBhbmQgY29tbWl0cyB0aGUgY2hhbmdlCiAgICAgIC8vRGVsZXRlIGFsbCB0aGUgdHJhY2tzIGluIGhlcnR6anMgaW4gdGhlIGN1cnJlbnQgdmVyc2lvbiAKICAgICAgdGhpcy5oZXJ0empzUHJvamVjdC50cmFja3MgPSBbXTsKICAgICAgdGhpcy50cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodHJhY2spIHsKICAgICAgICB2YXIgaGVydHpqc1RyYWNrID0gX3RoaXMxOC5oZXJ0empzUHJvamVjdC5uZXdUcmFjaygpOwogICAgICAgIC8vVE9ETzogaWYgdGhlIGZpbGVzIGFyZSBsb2NhbCwgd2UgbmVlZCB0byBjb3B5IHRoZW0gbG9jYWxseQogICAgICAgIHZhciBoZXJ0empzQ2xpcCA9IHVuZGVmaW5lZDsKICAgICAgICBpZiAodHJhY2suc3JjIGluc3RhbmNlb2YgRmlsZSkgewogICAgICAgICAgdmFyIF91cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHRyYWNrLnNyYyk7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCdGaWxlIGlzIG5vdCBhIHN0cmluZywgaXQgaXMgYSBmaWxlLCBjcmVhdGluZyBhIGJsb2cgYW5kIGEgdXJsIGFuZCByZWZlcmVuY2luZyBpdCcsIHVybCkKICAgICAgICAgIGhlcnR6anNDbGlwID0gaGVydHpqc1RyYWNrLm5ld0NsaXAoX3VybCk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdHJhY2suc3JjID09PSAnc3RyaW5nJyB8fCB0cmFjay5zcmMgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgIGhlcnR6anNDbGlwID0gaGVydHpqc1RyYWNrLm5ld0NsaXAodHJhY2suc3JjKTsKICAgICAgICB9IGVsc2UgaWYgKF90eXBlb2YodHJhY2spID09ICdvYmplY3QnICYmICEhdHJhY2suYnVmZmVyKSB7CiAgICAgICAgICAvL1RoaXMgaXMgYW4gYXVkaW8gYnVmZmVyLCBzbyB3ZSBjcmVhdGUgYSB0ZW1wb3JhcnkgZmlsZSBmcm9tIGl0CiAgICAgICAgICB2YXIgYXVkaW9CdWZmZXIgPSB0cmFjay5idWZmZXI7CiAgICAgICAgICB2YXIgd2F2QnVmZmVyID0gQXVkaW9CdWZmZXJUb1dhdihhdWRpb0J1ZmZlcik7CiAgICAgICAgICB2YXIgYmxvYiA9IG5ldyB3aW5kb3cuQmxvYihbbmV3IERhdGFWaWV3KHdhdkJ1ZmZlcildLCB7CiAgICAgICAgICAgIHR5cGU6ICdhdWRpby93YXYnCiAgICAgICAgICB9KTsKICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgICAgICAgIGhlcnR6anNDbGlwID0gaGVydHpqc1RyYWNrLm5ld0NsaXAodXJsKTsKICAgICAgICB9CiAgICAgICAgaGVydHpqc0NsaXAuc2V0U3RhcnRzQXQodHJhY2suc3RhcnRUaW1lKTsKICAgICAgICBoZXJ0empzQ2xpcC5zZXREdXJhdGlvbih0cmFjay5jdWVPdXQpOwogICAgICAgIGhlcnR6anNDbGlwLnNldE9mZnNldCh0cmFjay5jdWVJbik7CiAgICAgICAgLy9UT0RPOkFkZCBlZmZlY3RzIGhlcmUKICAgICAgfSk7CiAgICAgIHRoaXMuaGVydHpqc1Byb2plY3QuY29tbWl0KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAidW5kbyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gdW5kbygpIHsKICAgICAgaWYgKCF0aGlzLmhlcnR6anNQcm9qZWN0KSByZXR1cm4gZmFsc2U7CiAgICAgIHZhciBjdXJyZW50SW5kZXggPSB0aGlzLmhlcnR6anNQcm9qZWN0Lmhpc3RvcnkuY3VycmVudEluZGV4OwogICAgICBpZiAoY3VycmVudEluZGV4IDw9IDEpIHJldHVybiBmYWxzZTsKICAgICAgdGhpcy5oZXJ0empzUHJvamVjdC51bmRvKCk7CiAgICAgIHRoaXMuY29weUZyb21IZXJ0empzKHRoaXMuaGVydHpqc1Byb2plY3QpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlZG8iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZG8oKSB7CiAgICAgIHZhciBpc0luTGFzdFZlcnNpb24gPSB0aGlzLmhlcnR6anNQcm9qZWN0LmlzSW5MYXN0VmVyc2lvbigpOwogICAgICBpZiAoaXNJbkxhc3RWZXJzaW9uKSByZXR1cm4gZmFsc2U7CiAgICAgIC8vY29uc29sZS5sb2coJ2N1cnJlbnRseSBpbiB0aGUnLCB0aGlzLmhlcnR6anNQcm9qZWN0Lmhpc3RvcnkuY3VycmVudEluZGV4LCAndmVyc2lvbicsIGlzSW5MYXN0VmVyc2lvbiA/ICcgTEFTVCBWRVJTSU9OJyA6ICcnKQogICAgICB0aGlzLmhlcnR6anNQcm9qZWN0LnJlZG8oKTsKICAgICAgdGhpcy5jb3B5RnJvbUhlcnR6anModGhpcy5oZXJ0empzUHJvamVjdCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SGVydGp6UHJvamVjdEluc3RhbmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRIZXJ0anpQcm9qZWN0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiB0aGlzLmhlcnR6anNQcm9qZWN0OwogICAgfQoKICAgIC8qKg0KICAgICAqIFRoaXMgbWV0aG9kIHdpbGwgZXhwb3J0IHRoZSBwcm9qZWN0IGFzIGEgemlwIGZpbGUNCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICJleHBvcnRaaXBQcm9qZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBleHBvcnRaaXBQcm9qZWN0KCkgewogICAgICB2YXIgemlwID0gbmV3IEpTWmlwKCk7CiAgICAgIHppcC5maWxlKCdwcm9qZWN0Lmpzb24nLCBKU09OLnN0cmluZ2lmeSh0aGlzLmhlcnR6anNQcm9qZWN0KSk7CiAgICAgIHppcC5maWxlKCdSRUFETUUudHh0JywgJ05vdGhpbmcgaGVyZSEnKTsKICAgICAgdmFyIGZldGNoUHJvbWlzZXMgPSBbXTsKCiAgICAgIC8vTm93IHdlJ2xsIGJlIHNhdmluZyBhbGwgdGhlIG1lZGlhIGZpbGVzIGZvciB0aGUgY3VycmVudCB2ZXJzaW9uCiAgICAgIHRoaXMuaGVydHpqc1Byb2plY3QudHJhY2tzLmZvckVhY2goZnVuY3Rpb24gKHRyYWNrKSB7CiAgICAgICAgdHJhY2suY2xpcHMuZm9yRWFjaChmdW5jdGlvbiAoY2xpcCkgewogICAgICAgICAgLy9jb25zb2xlLmxvZygnUHJvY2Vzc2luZyBjbGlwJywgY2xpcCkKICAgICAgICAgIGlmIChjbGlwLnBhdGguaW5kZXhPZigiYmxvYjoiKSA+PSAwKSB7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2FkZGluZyB0aGUgZmlsZScsIGNsaXAucGF0aCkKCiAgICAgICAgICAgIHZhciBmZXRjaFByb21pc2UgPSBmZXRjaChjbGlwLnBhdGgpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHsKICAgICAgICAgICAgICByZXR1cm4gcmVzcC5ibG9iKCk7CiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdhZGRpbmcgZmlsZSB0byB6aXAnLCBkYXRhKQoKICAgICAgICAgICAgICB2YXIgZmlsZU5hbWUgPSBjbGlwLnBhdGguc3BsaXQoJy8nKS5wb3AoKTsKICAgICAgICAgICAgICB6aXAuZmlsZSgnYmxvYi4nICsgZmlsZU5hbWUsIGRhdGEpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZmV0Y2hQcm9taXNlcy5wdXNoKGZldGNoUHJvbWlzZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gUHJvbWlzZS5hbGwoZmV0Y2hQcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gR2VuZXJhdGUgdGhlIFpJUCBmaWxlIGFmdGVyIGFsbCBvcGVyYXRpb25zIGFyZSBmaW5pc2hlZAogICAgICAgIHJldHVybiB6aXAuZ2VuZXJhdGVBc3luYyh7CiAgICAgICAgICB0eXBlOiAnYmxvYicKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgYWNjZXB0cyBhIFpJUCBwcm9qZWN0DQogICAgICogVGhlIHByb2plY3QgbXVzdCBjb250YWluYSBhIGZpbGUgY2FsbGVkIHByb2plY3QuanNvbiBhbmQgdGhlIG1lZGlhcyByZWZlcmVuY2VkIGluIGl0DQogICAgICogQHBhcmFtIHt9IHppcEZpbGUgDQogICAgICovCiAgfSwgewogICAga2V5OiAiaW1wb3J0WmlwUHJvamVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW1wb3J0WmlwUHJvamVjdCh6aXBGaWxlKSB7CiAgICAgIHZhciBwbGF5bGlzdCA9IHRoaXM7CiAgICAgIGlmICghcGxheWxpc3QuaGVydHpqc1Byb2plY3QpIHRoaXMuY29tbWl0KCk7CgogICAgICAvLyBMb2FkIHRoZSBaSVAgZmlsZSB1c2luZyBKU1ppcAogICAgICBKU1ppcC5sb2FkQXN5bmMoemlwRmlsZSAvKiBCbG9iIGNvbnRhaW5pbmcgdGhlIFpJUCBmaWxlICovKS50aGVuKGZ1bmN0aW9uICh6aXApIHsKICAgICAgICAvL0ZpcnN0IHdlIHJlYWQgdGhlIHByb2plY3QuanNvbiBmaWxlCiAgICAgICAgemlwLmZpbGUoInByb2plY3QuanNvbiIpLmFzeW5jKCJibG9iIikudGhlbihmdW5jdGlvbiAocHJvamVjdEZpbGVCbG9iKSB7CiAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgLy9XZSByZWFkdCB0aGUgcHJvamV0IG9iamVjdCBmcm9tIHRoZSBmaWxlIGFuZCBjb3B5IGl0IGluIHRoZSBtZW1vcnkKICAgICAgICAgICAgdmFyIHByb2plY3RKc29uID0gZXZlbnQudGFyZ2V0LnJlc3VsdDsKICAgICAgICAgICAgdmFyIHByb2plY3RPYmplY3QgPSBKU09OLnBhcnNlKHByb2plY3RKc29uKTsKICAgICAgICAgICAgcGxheWxpc3QuaGVydHpqc1Byb2plY3QuaGlzdG9yeS5zZXRIaXN0b3J5U3RhY2socHJvamVjdE9iamVjdC5oaXN0b3J5LnN0YWNrKTsKICAgICAgICAgICAgcGxheWxpc3QuaGVydHpqc1Byb2plY3QuaGlzdG9yeS5zZXRDb29sZG93blN0YXRlKHByb2plY3RPYmplY3QuaGlzdG9yeS5jb29sZG93blN0YXRlKTsKICAgICAgICAgICAgcGxheWxpc3QuaGVydHpqc1Byb2plY3QuaGlzdG9yeS5zZXRDdXJyZW50SW5kZXgocHJvamVjdE9iamVjdC5oaXN0b3J5LmN1cnJlbnRJbmRleCk7CiAgICAgICAgICAgIHBsYXlsaXN0LmhlcnR6anNQcm9qZWN0Lmhpc3Rvcnkuc2V0Q29vbGRvd24ocHJvamVjdE9iamVjdC5oaXN0b3J5LmNvb2xkb3duKTsKICAgICAgICAgICAgcGxheWxpc3QuaGVydHpqc1Byb2plY3QudHJhY2tzID0gcHJvamVjdE9iamVjdC50cmFja3M7CgogICAgICAgICAgICAvLyBMb29wIHRocm91Z2ggZWFjaCBmaWxlIGluIHRoZSBaSVAgYXJjaGl2ZQogICAgICAgICAgICB2YXIgZmlsZUxvYWRpbmdQcm9taXNlcyA9IFtdOwogICAgICAgICAgICB6aXAuZm9yRWFjaChmdW5jdGlvbiAocmVsYXRpdmVQYXRoLCB6aXBFbnRyeSkgewogICAgICAgICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSBmaWxlIChub3QgYSBkaXJlY3RvcnkpCiAgICAgICAgICAgICAgaWYgKCF6aXBFbnRyeS5kaXIpIHsKICAgICAgICAgICAgICAgIGlmICh6aXBFbnRyeS5uYW1lID09ICdwcm9qZWN0Lmpzb24nKSByZXR1cm47CgogICAgICAgICAgICAgICAgLy8gRXh0cmFjdCB0aGUgZmlsZSBjb250ZW50IGFzIGEgQmxvYgogICAgICAgICAgICAgICAgdmFyIGZpbGVMb2FkaW5nUHJvbWlzZSA9IHppcEVudHJ5LmFzeW5jKCJibG9iIikudGhlbihmdW5jdGlvbiAoZmlsZUJsb2IpIHsKICAgICAgICAgICAgICAgICAgLy8gVXNlIGZpbGVCbG9iIGhlcmUgKGZvciBleGFtcGxlLCBjcmVhdGUgYW4gb2JqZWN0IFVSTCB0byBkaXNwbGF5IGltYWdlcywgb3IgcmVhZCB0ZXh0IGNvbnRlbnQpCiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJGaWxlIE5hbWU6ICIgKyB6aXBFbnRyeS5uYW1lKTsKCiAgICAgICAgICAgICAgICAgIC8vSWYgdGhlIGZpbGUgaXMgYSB0ZW1wb3JhcnkgYmxvYiBmaWxlLCB3ZSBzaW1wbHkgZ2VuZXJhdGUgYSB1cmwgZm9yIGl0IGFuZCB1cGRhdGUgdGhlIHByb2plY3QKICAgICAgICAgICAgICAgICAgLy90byByZWZlcmVuY2UgdGhlIG5ldyB0ZW1wb3JhcnkgdXJsCiAgICAgICAgICAgICAgICAgIGlmICh6aXBFbnRyeS5uYW1lLnN1YnN0cmluZygwLCA1KSA9PSAnYmxvYi4nKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1VybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZUJsb2IpOwogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmhlcnR6anNQcm9qZWN0LnRyYWNrcy5mb3JFYWNoKGZ1bmN0aW9uICh0cmFjaykgewogICAgICAgICAgICAgICAgICAgICAgdHJhY2suY2xpcHMuZm9yRWFjaChmdW5jdGlvbiAoY2xpcCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnY2hlY2tpbmcgY2xpcCcsIGNsaXAucGF0aCkKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjbGlwRmlsZU5hbWUgPSBjbGlwLnBhdGguc3BsaXQoJy8nKS5wb3AoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNsaXBGaWxlTmFtZSA9PSB6aXBFbnRyeS5uYW1lLnN1YnN0cmluZyg1KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXAucGF0aCA9IG5ld1VybDsKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndXBkYXRpbmcgY2xpcCcsIGNsaXAucGF0aCwgJ3RvJywgbmV3VXJsKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAvL1RPRE86IGZpbmQgYWxsIHRoZSByZWZlcmVuY2VzIGluIHRoZSBpbiBhbGwgdGhlIGhpc3RvcnkgdmVyc2lvbnMgYXMgd2VsbCBhbmQgdXBkYXRlIHRoZW0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmaWxlTG9hZGluZ1Byb21pc2VzLnB1c2goZmlsZUxvYWRpbmdQcm9taXNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBQcm9taXNlLmFsbChmaWxlTG9hZGluZ1Byb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnY29weWluZyBmcm9tIGhlcnR6anMnKQogICAgICAgICAgICAgIHBsYXlsaXN0LmNvcHlGcm9tSGVydHpqcyhwbGF5bGlzdC5oZXJ0empzUHJvamVjdCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKICAgICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KHByb2plY3RGaWxlQmxvYik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH1dKTsKfSgpOwpleHBvcnQgeyBfZGVmYXVsdCBhcyBkZWZhdWx0IH07"},{"version":3,"names":["_defaults","h","diff","patch","InlineWorker","JSZip","pixelsToSeconds","resampleAudioBuffer","LoaderFactory","ScrollHook","TimeScale","Track","Playout","AnnotationList","ExportWavWorkerFunction","RecorderWorkerFunction","AudioProject","AudioBufferToWav","_default","_classCallCheck","tracks","soloedTracks","mutedTracks","collapsedTracks","playoutPromises","cursor","playbackSeconds","duration","scrollLeft","scrollTimer","undefined","showTimescale","isScrolling","fadeType","masterGain","annotations","durationFormat","isAutomaticScroll","resetDrawTimer","hertzjsProject","hertjsMapper","Map","_createClass","key","value","setHertzjsProject","initExporter","exportWorker","initRecorder","stream","_this","mediaRecorder","MediaRecorder","onstart","start","track","setName","setEnabledStates","setEventEmitter","ee","setStartTime","recordingTrack","push","chunks","working","ondataavailable","e","data","recording","Blob","type","loader","createLoader","ac","load","then","audioBuffer","recorderWorker","postMessage","samples","getChannelData","samplesPerPixel","setCues","setBuffer","setPlayout","masterGainNode","adjustDuration","catch","onstop","onmessage","setPeaks","drawRequest","setShowTimeScale","show","setMono","mono","setExclSolo","exclSolo","setSeekStyle","style","seekStyle","getSeekStyle","setSampleRate","sampleRate","setSamplesPerPixel","setAudioContext","createGain","getAudioContext","setControlOptions","controlOptions","controls","setWaveHeight","height","waveHeight","setCollapsedWaveHeight","collapsedWaveHeight","setColors","colors","setBarWidth","width","barWidth","setBarGap","barGap","setAnnotations","config","controlWidth","annotationList","editable","linkEndpoints","isContinuousPlay","setEffects","effectsGraph","getEventEmitter","setUpEventEmitter","_this2","on","val","format","end","isPlaying","lastSeeked","pausedAt","restartPlayFrom","seek","emit","startOfflineRender","state","setState","deltaTime","getStartTime","record","play","pause","stop","rewind","fastForward","clear","soloTrack","adjustTrackPlayout","muteTrack","removeTrack","opts","collapseTrack","volume","setGainLevel","forEach","setMasterGainLevel","setFadeIn","setFadeOut","panvalue","setStereoPanValue","file","src","name","getActiveTrack","timeSelection","getTimeSelection","removePart","calculatePeaks","setTimeSelection","razorCut","trim","timeSelectionStart","createTrackFromSplit","trackToSplit","splitTime","startTime","fadeOut","removeFade","zoomIndex","Math","max","zoom","zoomLevels","setZoom","min","length","clearTimeout","setTimeout","hertjzProject","copyFromHertzjs","commit","undo","redo","zipFile","importZipProject","exportZipProject","blob","trackList","_this3","loadPromises","map","trackInfo","Promise","all","audioBuffers","index","info","states","fadeIn","cueIn","cuein","cueOut","cueout","gain","muted","soloed","selection","selected","peaks","customClass","waveOutlineColor","stereoPan","effects","playout","setCustomClass","setWaveOutlineColor","shape","setActiveTrack","setPeakData","getState","concat","draw","render","_ref","enabledStates","buffer","indexOf","peakData","fade","fades","endTime","activeTrack","isSegmentSelection","arguments","_startOfflineRender","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this4","setUpChain","currentTime","mg","wrap","_callee$","_context","prev","next","isRendering","abrupt","offlineAudioContext","window","OfflineAudioContext","webkitOfflineAudioContext","setMasterEffects","setOfflinePlayout","schedulePlay","shouldPlay","shouldTrackPlay","isOffline","startRendering","sent","includes","command","_x","apply","setZoomIndex","setZoomLevels","levels","_this5","splice","collapsed","scheduleStop","trackLists","list","_this6","setShouldPlay","reduce","getEndTime","getCurrentTime","cursorPos","getElapsedTime","lastPlay","setMasterGain","stopAnimation","editor","bind","_this7","startAnimation","playbackReset","resume","_this8","disconnect","_this9","_this10","viewDuration","_this11","_this12","_this13","lastDraw","animationRequest","requestAnimationFrame","updateEditor","cancelAnimationFrame","_this14","elapsed","_this15","newTree","patches","tree","rootNode","clientWidth","getTrackRenderData","defaults","resolution","isActive","playlistLength","isActiveTrack","renderAnnotations","renderTimeScale","timeScale","renderTrackSection","_this16","trackElements","attributes","onscroll","target","hook","containerChildren","getInfo","getTrackDetails","_copyFromHertzjs","_callee3","_this17","_callee3$","_context3","hertzjsTrack","clips","_ref2","_callee2","hertjzClip","_callee2$","_context2","path","match","startsAt","offset","hertzjsEffect","params","_x3","_x2","_this18","hjz","newTrack","hertzjsClip","File","url","URL","createObjectURL","newClip","String","_typeof","wavBuffer","DataView","setStartsAt","setDuration","setOffset","currentIndex","history","isInLastVersion","getHertjzProjectInstance","zip","JSON","stringify","fetchPromises","clip","fetchPromise","fetch","resp","fileName","split","pop","generateAsync","playlist","loadAsync","async","projectFileBlob","reader","FileReader","onload","event","projectJson","result","projectObject","parse","setHistoryStack","stack","setCooldownState","cooldownState","setCurrentIndex","setCooldown","cooldown","fileLoadingPromises","relativePath","zipEntry","dir","fileLoadingPromise","fileBlob","substring","newUrl","clipFileName","readAsText","default"],"sources":["C:/teste-login/src/Playlist.js"],"sourcesContent":["import _defaults from \"lodash.defaultsdeep\";\r\nimport h from \"virtual-dom/h\";\r\nimport diff from \"virtual-dom/diff\";\r\nimport patch from \"virtual-dom/patch\";\r\nimport InlineWorker from \"inline-worker\";\r\n\r\nimport JSZip from 'jszip';\r\n\r\n\r\nimport { pixelsToSeconds } from \"./utils/conversions\";\r\nimport { resampleAudioBuffer } from \"./utils/audioData\";\r\nimport LoaderFactory from \"./track/loader/LoaderFactory\";\r\nimport ScrollHook from \"./render/ScrollHook\";\r\nimport TimeScale from \"./TimeScale\";\r\nimport Track from \"./Track\";\r\nimport Playout from \"./Playout\";\r\nimport AnnotationList from \"./annotation/AnnotationList\";\r\nimport ExportWavWorkerFunction from \"./utils/exportWavWorker\";\r\nimport RecorderWorkerFunction from \"./utils/recorderWorker\";\r\nimport AudioProject from \"hertzjs\";\r\n\r\nimport AudioBufferToWav from 'audiobuffer-to-wav'\r\n\r\nexport default class {\r\n  constructor() {\r\n    this.tracks = [];\r\n    this.soloedTracks = [];\r\n    this.mutedTracks = [];\r\n    this.collapsedTracks = [];\r\n    this.playoutPromises = [];\r\n\r\n    this.cursor = 0;\r\n    this.playbackSeconds = 0;\r\n    this.duration = 0;\r\n    this.scrollLeft = 0;\r\n    this.scrollTimer = undefined;\r\n    this.showTimescale = false;\r\n    // whether a user is scrolling the waveform\r\n    this.isScrolling = false;\r\n\r\n    this.fadeType = \"logarithmic\";\r\n    this.masterGain = 1;\r\n    this.annotations = [];\r\n    this.durationFormat = \"hh:mm:ss.uuu\";\r\n    this.isAutomaticScroll = false;\r\n    this.resetDrawTimer = undefined;\r\n\r\n    // Hertjz stuff\r\n    this.hertzjsProject = undefined;\r\n    this.hertjsMapper = new Map();\r\n\r\n\r\n  }\r\n\r\n  setHertzjsProject(hertzjsProject) {\r\n    this.hertzjsProject = hertzjsProject;\r\n  }\r\n\r\n  // TODO extract into a plugin\r\n  initExporter() {\r\n    this.exportWorker = new InlineWorker(ExportWavWorkerFunction);\r\n  }\r\n\r\n  // TODO extract into a plugin\r\n  initRecorder(stream) {\r\n    this.mediaRecorder = new MediaRecorder(stream);\r\n\r\n    this.mediaRecorder.onstart = () => {\r\n      const start = this.cursor;\r\n      const track = new Track();\r\n      track.setName(\"Recording\");\r\n      track.setEnabledStates();\r\n      track.setEventEmitter(this.ee);\r\n      track.setStartTime(start);\r\n\r\n      this.recordingTrack = track;\r\n      this.tracks.push(track);\r\n\r\n      this.chunks = [];\r\n      this.working = false;\r\n    };\r\n\r\n    this.mediaRecorder.ondataavailable = (e) => {\r\n      this.chunks.push(e.data);\r\n\r\n      // throttle peaks calculation\r\n      if (!this.working) {\r\n        const recording = new Blob(this.chunks, {\r\n          type: \"audio/ogg; codecs=opus\",\r\n        });\r\n        const loader = LoaderFactory.createLoader(recording, this.ac);\r\n        loader\r\n          .load()\r\n          .then((audioBuffer) => {\r\n            // ask web worker for peaks.\r\n            this.recorderWorker.postMessage({\r\n              samples: audioBuffer.getChannelData(0),\r\n              samplesPerPixel: this.samplesPerPixel,\r\n            });\r\n            this.recordingTrack.setCues(0, audioBuffer.duration);\r\n            this.recordingTrack.setBuffer(audioBuffer);\r\n            this.recordingTrack.setPlayout(\r\n              new Playout(this.ac, audioBuffer, this.masterGainNode)\r\n            );\r\n            this.adjustDuration();\r\n          })\r\n          .catch(() => {\r\n            this.working = false;\r\n          });\r\n        this.working = true;\r\n      }\r\n    };\r\n\r\n    this.mediaRecorder.onstop = () => {\r\n      this.chunks = [];\r\n      this.working = false;\r\n      this.cursor = this.duration + 0.3;\r\n    };\r\n\r\n    this.recorderWorker = new InlineWorker(RecorderWorkerFunction);\r\n    // use a worker for calculating recording peaks.\r\n    this.recorderWorker.onmessage = (e) => {\r\n      this.recordingTrack.setPeaks(e.data);\r\n      this.working = false;\r\n      this.drawRequest();\r\n    };\r\n  }\r\n\r\n  setShowTimeScale(show) {\r\n    this.showTimescale = show;\r\n  }\r\n\r\n  setMono(mono) {\r\n    this.mono = mono;\r\n  }\r\n\r\n  setExclSolo(exclSolo) {\r\n    this.exclSolo = exclSolo;\r\n  }\r\n\r\n  setSeekStyle(style) {\r\n    this.seekStyle = style;\r\n  }\r\n\r\n  getSeekStyle() {\r\n    return this.seekStyle;\r\n  }\r\n\r\n  setSampleRate(sampleRate) {\r\n    this.sampleRate = sampleRate;\r\n  }\r\n\r\n  setSamplesPerPixel(samplesPerPixel) {\r\n    this.samplesPerPixel = samplesPerPixel;\r\n  }\r\n\r\n  setAudioContext(ac) {\r\n    this.ac = ac;\r\n    this.masterGainNode = ac.createGain();\r\n  }\r\n\r\n  getAudioContext() {\r\n    return this.ac;\r\n  }\r\n\r\n  setControlOptions(controlOptions) {\r\n    this.controls = controlOptions;\r\n  }\r\n\r\n  setWaveHeight(height) {\r\n    this.waveHeight = height;\r\n  }\r\n\r\n  setCollapsedWaveHeight(height) {\r\n    this.collapsedWaveHeight = height;\r\n  }\r\n\r\n  setColors(colors) {\r\n    this.colors = colors;\r\n  }\r\n\r\n  setBarWidth(width) {\r\n    this.barWidth = width;\r\n  }\r\n\r\n  setBarGap(width) {\r\n    this.barGap = width;\r\n  }\r\n\r\n  setAnnotations(config) {\r\n    const controlWidth = this.controls.show ? this.controls.width : 0;\r\n    this.annotationList = new AnnotationList(\r\n      this,\r\n      config.annotations,\r\n      config.controls,\r\n      config.editable,\r\n      config.linkEndpoints,\r\n      config.isContinuousPlay,\r\n      controlWidth\r\n    );\r\n  }\r\n\r\n  setEffects(effectsGraph) {\r\n    this.effectsGraph = effectsGraph;\r\n  }\r\n\r\n  setEventEmitter(ee) {\r\n    this.ee = ee;\r\n  }\r\n\r\n  getEventEmitter() {\r\n    return this.ee;\r\n  }\r\n\r\n  setUpEventEmitter() {\r\n    const ee = this.ee;\r\n\r\n    ee.on(\"automaticscroll\", (val) => {\r\n      this.isAutomaticScroll = val;\r\n    });\r\n\r\n    ee.on(\"durationformat\", (format) => {\r\n      this.durationFormat = format;\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"select\", (start, end, track) => {\r\n      if (this.isPlaying()) {\r\n        this.lastSeeked = start;\r\n        this.pausedAt = undefined;\r\n        this.restartPlayFrom(start);\r\n      } else {\r\n        // reset if it was paused.\r\n        this.seek(start, end, track);\r\n        this.ee.emit(\"timeupdate\", start);\r\n        this.drawRequest();\r\n      }\r\n    });\r\n\r\n    ee.on(\"startaudiorendering\", (type) => {\r\n      this.startOfflineRender(type);\r\n    });\r\n\r\n    ee.on(\"statechange\", (state) => {\r\n      this.setState(state);\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"shift\", (deltaTime, track) => {\r\n      track.setStartTime(track.getStartTime() + deltaTime);\r\n      this.adjustDuration();\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"record\", () => {\r\n      this.record();\r\n    });\r\n\r\n    ee.on(\"play\", (start, end) => {\r\n      this.play(start, end);\r\n    });\r\n\r\n    ee.on(\"pause\", () => {\r\n      this.pause();\r\n    });\r\n\r\n    ee.on(\"stop\", () => {\r\n      this.stop();\r\n    });\r\n\r\n    ee.on(\"rewind\", () => {\r\n      this.rewind();\r\n    });\r\n\r\n    ee.on(\"fastforward\", () => {\r\n      this.fastForward();\r\n    });\r\n\r\n    ee.on(\"clear\", () => {\r\n      this.clear().then(() => {\r\n        this.drawRequest();\r\n      });\r\n    });\r\n\r\n    ee.on(\"solo\", (track) => {\r\n      this.soloTrack(track);\r\n      this.adjustTrackPlayout();\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"mute\", (track) => {\r\n      this.muteTrack(track);\r\n      this.adjustTrackPlayout();\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"removeTrack\", (track) => {\r\n      this.removeTrack(track);\r\n      this.adjustTrackPlayout();\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"changeTrackView\", (track, opts) => {\r\n      this.collapseTrack(track, opts);\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"volumechange\", (volume, track) => {\r\n      track.setGainLevel(volume / 100);\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"mastervolumechange\", (volume) => {\r\n      this.masterGain = volume / 100;\r\n      this.tracks.forEach((track) => {\r\n        track.setMasterGainLevel(this.masterGain);\r\n      });\r\n    });\r\n\r\n    ee.on(\"fadein\", (duration, track) => {\r\n      track.setFadeIn(duration, this.fadeType);\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"fadeout\", (duration, track) => {\r\n      track.setFadeOut(duration, this.fadeType);\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"stereopan\", (panvalue, track) => {\r\n      track.setStereoPanValue(panvalue);\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"fadetype\", (type) => {\r\n      this.fadeType = type;\r\n    });\r\n\r\n    ee.on(\"newtrack\", (file) => {\r\n      this.load([\r\n        {\r\n          src: file,\r\n          name: file.name,\r\n        },\r\n      ]);\r\n    });\r\n\r\n    ee.on(\"cut\", () => {\r\n      const track = this.getActiveTrack();\r\n      const timeSelection = this.getTimeSelection();\r\n\r\n      track.removePart(timeSelection.start, timeSelection.end, this.ac, track);\r\n      track.calculatePeaks(this.samplesPerPixel, this.sampleRate);\r\n\r\n      this.setTimeSelection(0, 0);\r\n      this.adjustDuration();\r\n      this.drawRequest();\r\n      this.ee.emit(\"cutfinished\");\r\n    });\r\n\r\n    ee.on(\"razorCut\", () => {\r\n      const Track = this.getActiveTrack();\r\n      const timeSelection = this.getTimeSelection();\r\n      Track.razorCut(timeSelection.start, this.ac, Track);\r\n    });\r\n\r\n    ee.on(\"trim\", () => {\r\n      const track = this.getActiveTrack();\r\n      const timeSelection = this.getTimeSelection();\r\n\r\n      track.trim(timeSelection.start, timeSelection.end);\r\n      track.calculatePeaks(this.samplesPerPixel, this.sampleRate);\r\n\r\n      this.setTimeSelection(0, 0);\r\n      this.adjustDuration();\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"split\", () => {\r\n      const track = this.getActiveTrack();\r\n      const timeSelection = this.getTimeSelection();\r\n      const timeSelectionStart = timeSelection.start;\r\n      this.createTrackFromSplit({\r\n        trackToSplit: track,\r\n        name: track.name + \"_1\",\r\n        splitTime: timeSelectionStart,\r\n      });\r\n      track.trim(track.startTime, timeSelectionStart);\r\n      if (track.fadeOut) {\r\n        track.removeFade(track.fadeOut);\r\n        track.fadeOut = undefined;\r\n      }\r\n\r\n      track.calculatePeaks(this.samplesPerPixel, this.sampleRate);\r\n\r\n      this.drawRequest();\r\n    });\r\n\r\n    ee.on(\"zoomin\", () => {\r\n      const zoomIndex = Math.max(0, this.zoomIndex - 1);\r\n      const zoom = this.zoomLevels[zoomIndex];\r\n\r\n      if (zoom !== this.samplesPerPixel) {\r\n        this.setZoom(zoom);\r\n        this.drawRequest();\r\n      }\r\n    });\r\n\r\n    ee.on(\"zoomout\", () => {\r\n      const zoomIndex = Math.min(\r\n        this.zoomLevels.length - 1,\r\n        this.zoomIndex + 1\r\n      );\r\n      const zoom = this.zoomLevels[zoomIndex];\r\n\r\n      if (zoom !== this.samplesPerPixel) {\r\n        this.setZoom(zoom);\r\n        this.drawRequest();\r\n      }\r\n    });\r\n\r\n    ee.on(\"scroll\", () => {\r\n      this.isScrolling = true;\r\n      this.drawRequest();\r\n      clearTimeout(this.scrollTimer);\r\n      this.scrollTimer = setTimeout(() => {\r\n        this.isScrolling = false;\r\n      }, 200);\r\n    });\r\n\r\n    ee.on('hertjz-loaded', (hertjzProject) => {\r\n      this.hertzjsProject = hertjzProject;\r\n      this.copyFromHertzjs(hertjzProject);\r\n    })\r\n\r\n    ee.on('audiosourcesrendered', () => {\r\n      // this.commit();\r\n      // console.log(this.tracks)\r\n      //console.log(this.hertzjsProject)\r\n    })\r\n\r\n    ee.on('commit', () => {\r\n      this.commit();\r\n    })\r\n\r\n    ee.on('undo', () => {\r\n      this.undo();\r\n    })\r\n\r\n    ee.on('redo', () => {\r\n      this.redo();\r\n    })\r\n\r\n    ee.on('importZipProject', (zipFile) => {\r\n      this.importZipProject(zipFile)\r\n    })\r\n\r\n    ee.on('exportZipProject', () => {\r\n      this.exportZipProject().then((blob) => {\r\n        this.ee.emit(\"zipProjectExported\", blob);\r\n      })\r\n    })\r\n  }\r\n\r\n  load(trackList) {\r\n    const loadPromises = trackList.map((trackInfo) => {\r\n      const loader = LoaderFactory.createLoader(\r\n        trackInfo.src,\r\n        this.ac,\r\n        this.ee\r\n      );\r\n      return loader.load().then((audioBuffer) => {\r\n        if (audioBuffer.sampleRate === this.sampleRate) {\r\n          return audioBuffer;\r\n        } else {\r\n          return resampleAudioBuffer(audioBuffer, this.sampleRate);\r\n        }\r\n      });\r\n    });\r\n\r\n    return Promise.all(loadPromises)\r\n      .then((audioBuffers) => {\r\n        this.ee.emit(\"audiosourcesloaded\");\r\n\r\n        const tracks = audioBuffers.map((audioBuffer, index) => {\r\n          const info = trackList[index];\r\n          const name = info.name || \"Untitled\";\r\n          const start = info.start || 0;\r\n          const states = info.states || {};\r\n          const fadeIn = info.fadeIn;\r\n          const fadeOut = info.fadeOut;\r\n          const cueIn = info.cuein || 0;\r\n          const cueOut = info.cueout || audioBuffer.duration;\r\n          const gain = info.gain || 1;\r\n          const muted = info.muted || false;\r\n          const soloed = info.soloed || false;\r\n          const selection = info.selected;\r\n          const peaks = info.peaks || { type: \"WebAudio\", mono: this.mono };\r\n          const customClass = info.customClass || undefined;\r\n          const waveOutlineColor = info.waveOutlineColor || undefined;\r\n          const stereoPan = info.stereoPan || 0;\r\n          const effects = info.effects || null;\r\n\r\n          // webaudio specific playout for now.\r\n          const playout = new Playout(\r\n            this.ac,\r\n            audioBuffer,\r\n            this.masterGainNode\r\n          );\r\n\r\n          const track = new Track();\r\n          track.src = info.src;\r\n          track.setBuffer(audioBuffer);\r\n          track.setName(name);\r\n          track.setEventEmitter(this.ee);\r\n          track.setEnabledStates(states);\r\n          track.setCues(cueIn, cueOut);\r\n          track.setCustomClass(customClass);\r\n          track.setWaveOutlineColor(waveOutlineColor);\r\n\r\n          if (fadeIn !== undefined) {\r\n            track.setFadeIn(fadeIn.duration, fadeIn.shape);\r\n          }\r\n\r\n          if (fadeOut !== undefined) {\r\n            track.setFadeOut(fadeOut.duration, fadeOut.shape);\r\n          }\r\n\r\n          if (selection !== undefined) {\r\n            this.setActiveTrack(track);\r\n            this.setTimeSelection(selection.start, selection.end);\r\n          }\r\n\r\n          if (peaks !== undefined) {\r\n            track.setPeakData(peaks);\r\n          }\r\n\r\n          track.setState(this.getState());\r\n          track.setStartTime(start);\r\n          track.setPlayout(playout);\r\n\r\n          track.setGainLevel(gain);\r\n          track.setStereoPanValue(stereoPan);\r\n          if (effects) {\r\n            track.setEffects(effects);\r\n          }\r\n\r\n          if (muted) {\r\n            this.muteTrack(track);\r\n          }\r\n\r\n          if (soloed) {\r\n            this.soloTrack(track);\r\n          }\r\n\r\n          // extract peaks with AudioContext for now.\r\n          track.calculatePeaks(this.samplesPerPixel, this.sampleRate);\r\n\r\n          return track;\r\n        });\r\n\r\n        this.tracks = this.tracks.concat(tracks);\r\n        this.adjustDuration();\r\n        this.draw(this.render());\r\n\r\n        this.ee.emit(\"audiosourcesrendered\");\r\n      })\r\n      .catch((e) => {\r\n        this.ee.emit(\"audiosourceserror\", e);\r\n      });\r\n  }\r\n\r\n  createTrackFromSplit({ trackToSplit, name, splitTime }) {\r\n    const enabledStates = trackToSplit.enabledStates;\r\n    const buffer = trackToSplit.buffer;\r\n    const fadeOut = trackToSplit.fadeOut;\r\n    const cueIn = trackToSplit.cueIn;\r\n    const cueOut = trackToSplit.cueOut;\r\n    const gain = trackToSplit.gain || 1;\r\n\r\n    let muted = false;\r\n    if (this.mutedTracks.indexOf(trackToSplit) !== -1) {\r\n      muted = true;\r\n    }\r\n\r\n    let soloed = false;\r\n    if (this.soloedTracks.indexOf(trackToSplit) !== -1) {\r\n      soloed = true;\r\n    }\r\n\r\n    const peaks = trackToSplit.peakData;\r\n    const customClass = trackToSplit.customClass;\r\n    const waveOutlineColor = trackToSplit.waveOutlineColor;\r\n    const stereoPan = trackToSplit.stereoPan || 0;\r\n    const effects = trackToSplit.effectsGraph || null;\r\n\r\n    // webaudio specific playout for now.\r\n    const playout = new Playout(this.ac, buffer, this.masterGainNode);\r\n\r\n    const track = new Track();\r\n    track.src = trackToSplit.src;\r\n    track.setBuffer(buffer);\r\n    track.setName(name);\r\n    track.setEventEmitter(this.ee);\r\n    track.setEnabledStates(enabledStates);\r\n    track.setCues(cueIn, cueOut);\r\n    track.setCustomClass(customClass);\r\n    track.setWaveOutlineColor(waveOutlineColor);\r\n\r\n    if (fadeOut !== undefined) {\r\n      const fade = trackToSplit.fades[fadeOut];\r\n      track.setFadeOut(fade.end - fade.start, fade.shape);\r\n    }\r\n\r\n    if (peaks !== undefined) {\r\n      track.setPeakData(peaks);\r\n    }\r\n\r\n    track.setState(this.getState());\r\n    track.setPlayout(playout);\r\n\r\n    track.setGainLevel(gain);\r\n    track.setStereoPanValue(stereoPan);\r\n    if (effects) {\r\n      track.setEffects(effects);\r\n    }\r\n\r\n    if (muted) {\r\n      this.muteTrack(track);\r\n    }\r\n\r\n    if (soloed) {\r\n      this.soloTrack(track);\r\n    }\r\n\r\n    track.setStartTime(trackToSplit.startTime);\r\n    track.trim(splitTime, track.endTime);\r\n\r\n    // extract peaks with AudioContext for now.\r\n    track.calculatePeaks(this.samplesPerPixel, this.sampleRate);\r\n\r\n    this.tracks = this.tracks.concat([track]);\r\n    this.adjustDuration();\r\n    this.draw(this.render());\r\n    this.setActiveTrack(track);\r\n\r\n    this.ee.emit(\"audiosourcesrendered\");\r\n  }\r\n\r\n  /*\r\n    track instance of Track.\r\n  */\r\n  setActiveTrack(track) {\r\n    this.activeTrack = track;\r\n  }\r\n\r\n  getActiveTrack() {\r\n    return this.activeTrack;\r\n  }\r\n\r\n  isSegmentSelection() {\r\n    return this.timeSelection.start !== this.timeSelection.end;\r\n  }\r\n\r\n  /*\r\n    start, end in seconds.\r\n  */\r\n  setTimeSelection(start = 0, end) {\r\n    this.timeSelection = {\r\n      start,\r\n      end: end === undefined ? start : end,\r\n    };\r\n\r\n    this.cursor = start;\r\n  }\r\n\r\n  async startOfflineRender(type) {\r\n    if (this.isRendering) {\r\n      return;\r\n    }\r\n\r\n    this.isRendering = true;\r\n    this.offlineAudioContext = new (window.OfflineAudioContext || window.webkitOfflineAudioContext)(\r\n      2,\r\n      48000 * this.duration,\r\n      48000\r\n    );\r\n    const setUpChain = [];\r\n\r\n    this.ee.emit(\r\n      \"audiorenderingstarting\",\r\n      this.offlineAudioContext,\r\n      setUpChain\r\n    );\r\n\r\n    const currentTime = this.offlineAudioContext.currentTime;\r\n    const mg = this.offlineAudioContext.createGain();\r\n\r\n    this.tracks.forEach((track) => {\r\n      const playout = new Playout(this.offlineAudioContext, track.buffer, mg);\r\n      playout.setEffects(track.effectsGraph);\r\n      playout.setMasterEffects(this.effectsGraph);\r\n      track.setOfflinePlayout(playout);\r\n\r\n      track.schedulePlay(currentTime, 0, 0, {\r\n        shouldPlay: this.shouldTrackPlay(track),\r\n        masterGain: 1,\r\n        isOffline: true,\r\n      });\r\n    });\r\n\r\n    /*\r\n      TODO cleanup of different audio playouts handling.\r\n    */\r\n    await Promise.all(setUpChain);\r\n    const audioBuffer = await this.offlineAudioContext.startRendering();\r\n    if ([\"buffer\", \"mp3\", \"opus\", \"aac\"].includes(type)) {\r\n      this.ee.emit(\"audiorenderingfinished\", type, audioBuffer);\r\n      this.isRendering = false;\r\n    } else if (type === \"wav\") {\r\n      this.exportWorker.postMessage({\r\n        command: \"init\",\r\n        config: {\r\n          sampleRate: 48000,\r\n        },\r\n      });\r\n\r\n      // callback for `exportWAV`\r\n      this.exportWorker.onmessage = (e) => {\r\n        this.ee.emit(\"audiorenderingfinished\", type, e.data);\r\n        this.isRendering = false;\r\n\r\n        // clear out the buffer for next renderings.\r\n        this.exportWorker.postMessage({\r\n          command: \"clear\",\r\n        });\r\n      };\r\n\r\n      // send the channel data from our buffer to the worker\r\n      this.exportWorker.postMessage({\r\n        command: \"record\",\r\n        buffer: [audioBuffer.getChannelData(0), audioBuffer.getChannelData(1)],\r\n      });\r\n\r\n      this.exportWorker.postMessage({\r\n        command: \"exportWAV\",\r\n        type: \"audio/wav\",\r\n      });\r\n    }\r\n  }\r\n\r\n  getTimeSelection() {\r\n    return this.timeSelection;\r\n  }\r\n\r\n  setState(state) {\r\n    this.state = state;\r\n\r\n    this.tracks.forEach((track) => {\r\n      track.setState(state);\r\n    });\r\n  }\r\n\r\n  getState() {\r\n    return this.state;\r\n  }\r\n\r\n  setZoomIndex(index) {\r\n    this.zoomIndex = index;\r\n  }\r\n\r\n  setZoomLevels(levels) {\r\n    this.zoomLevels = levels;\r\n  }\r\n\r\n  setZoom(zoom) {\r\n    this.samplesPerPixel = zoom;\r\n    this.zoomIndex = this.zoomLevels.indexOf(zoom);\r\n    this.tracks.forEach((track) => {\r\n      track.calculatePeaks(zoom, this.sampleRate);\r\n    });\r\n  }\r\n\r\n  muteTrack(track) {\r\n    const index = this.mutedTracks.indexOf(track);\r\n\r\n    if (index > -1) {\r\n      this.mutedTracks.splice(index, 1);\r\n    } else {\r\n      this.mutedTracks.push(track);\r\n    }\r\n  }\r\n\r\n  soloTrack(track) {\r\n    const index = this.soloedTracks.indexOf(track);\r\n\r\n    if (index > -1) {\r\n      this.soloedTracks.splice(index, 1);\r\n    } else if (this.exclSolo) {\r\n      this.soloedTracks = [track];\r\n    } else {\r\n      this.soloedTracks.push(track);\r\n    }\r\n  }\r\n\r\n  collapseTrack(track, opts) {\r\n    if (opts.collapsed) {\r\n      this.collapsedTracks.push(track);\r\n    } else {\r\n      const index = this.collapsedTracks.indexOf(track);\r\n\r\n      if (index > -1) {\r\n        this.collapsedTracks.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeTrack(track) {\r\n    if (track.isPlaying()) {\r\n      track.scheduleStop();\r\n    }\r\n\r\n    const trackLists = [\r\n      this.mutedTracks,\r\n      this.soloedTracks,\r\n      this.collapsedTracks,\r\n      this.tracks,\r\n    ];\r\n    trackLists.forEach((list) => {\r\n      const index = list.indexOf(track);\r\n      if (index > -1) {\r\n        list.splice(index, 1);\r\n      }\r\n    });\r\n    this.adjustDuration();\r\n  }\r\n\r\n  adjustTrackPlayout() {\r\n    this.tracks.forEach((track) => {\r\n      track.setShouldPlay(this.shouldTrackPlay(track));\r\n    });\r\n  }\r\n\r\n  adjustDuration() {\r\n    this.duration = this.tracks.reduce(\r\n      (duration, track) => Math.max(duration, track.getEndTime()),\r\n      0\r\n    );\r\n  }\r\n\r\n  shouldTrackPlay(track) {\r\n    let shouldPlay;\r\n    // if there are solo tracks, only they should play.\r\n    if (this.soloedTracks.length > 0) {\r\n      shouldPlay = false;\r\n      if (this.soloedTracks.indexOf(track) > -1) {\r\n        shouldPlay = true;\r\n      }\r\n    } else {\r\n      // play all tracks except any muted tracks.\r\n      shouldPlay = true;\r\n      if (this.mutedTracks.indexOf(track) > -1) {\r\n        shouldPlay = false;\r\n      }\r\n    }\r\n\r\n    return shouldPlay;\r\n  }\r\n\r\n  isPlaying() {\r\n    return this.tracks.reduce(\r\n      (isPlaying, track) => isPlaying || track.isPlaying(),\r\n      false\r\n    );\r\n  }\r\n\r\n  /*\r\n   *   returns the current point of time in the playlist in seconds.\r\n   */\r\n  getCurrentTime() {\r\n    const cursorPos = this.lastSeeked || this.pausedAt || this.cursor;\r\n\r\n    return cursorPos + this.getElapsedTime();\r\n  }\r\n\r\n  getElapsedTime() {\r\n    return this.ac.currentTime - this.lastPlay;\r\n  }\r\n\r\n  setMasterGain(gain) {\r\n    this.ee.emit(\"mastervolumechange\", gain);\r\n  }\r\n\r\n  restartPlayFrom(start, end) {\r\n    this.stopAnimation();\r\n\r\n    this.tracks.forEach((editor) => {\r\n      editor.scheduleStop();\r\n    });\r\n\r\n    return Promise.all(this.playoutPromises).then(\r\n      this.play.bind(this, start, end)\r\n    );\r\n  }\r\n\r\n  play(startTime, endTime) {\r\n    clearTimeout(this.resetDrawTimer);\r\n\r\n    const currentTime = this.ac.currentTime;\r\n    const selected = this.getTimeSelection();\r\n    const playoutPromises = [];\r\n\r\n    const start =\r\n      startTime === 0 ? 0 : startTime || this.pausedAt || this.cursor;\r\n    let end = endTime;\r\n\r\n    if (!end && selected.end !== selected.start && selected.end > start) {\r\n      end = selected.end;\r\n    }\r\n\r\n    if (this.isPlaying()) {\r\n      return this.restartPlayFrom(start, end);\r\n    }\r\n\r\n    // TODO refector this in upcoming modernisation.\r\n    if (this.effectsGraph)\r\n      this.tracks && this.tracks[0].playout.setMasterEffects(this.effectsGraph);\r\n\r\n    this.tracks.forEach((track) => {\r\n      track.setState(\"cursor\");\r\n      playoutPromises.push(\r\n        track.schedulePlay(currentTime, start, end, {\r\n          shouldPlay: this.shouldTrackPlay(track),\r\n          masterGain: this.masterGain,\r\n        })\r\n      );\r\n    });\r\n\r\n    this.lastPlay = currentTime;\r\n    // use these to track when the playlist has fully stopped.\r\n    this.playoutPromises = playoutPromises;\r\n    this.startAnimation(start);\r\n\r\n    return Promise.all(this.playoutPromises);\r\n  }\r\n\r\n  pause() {\r\n    // console.log(\"pause\\n\");\r\n\r\n    if (!this.isPlaying() && this.mediaRecorder) {\r\n      if (this.mediaRecorder.state === \"recording\") {\r\n        // console.log(\"media recorder pause\\n\");\r\n        this.mediaRecorder.pause();\r\n        this.pausedAt = this.getCurrentTime();\r\n        return this.playbackReset();\r\n      }\r\n\r\n      if (this.mediaRecorder.state === \"paused\") {\r\n        // console.log(\"media recorder resume\\n\");\r\n        this.mediaRecorder.resume();\r\n        return this.playbackReset();\r\n      }\r\n      return Promise.all(this.playoutPromises);\r\n    }\r\n\r\n    if (this.isPlaying()) {\r\n      this.pausedAt = this.getCurrentTime();\r\n      return this.playbackReset();\r\n    }\r\n  }\r\n\r\n  stop() {\r\n    if (this.mediaRecorder && (this.mediaRecorder.state === \"recording\" || this.mediaRecorder.state === \"paused\")) {\r\n      this.mediaRecorder.stop();\r\n    }\r\n\r\n    this.pausedAt = undefined;\r\n    this.playbackSeconds = 0;\r\n    return this.playbackReset();\r\n  }\r\n\r\n  playbackReset() {\r\n    this.lastSeeked = undefined;\r\n    this.stopAnimation();\r\n\r\n    this.tracks.forEach((track) => {\r\n      track.scheduleStop();\r\n      track.setState(this.getState());\r\n    });\r\n\r\n    // TODO improve this.\r\n    this.masterGainNode.disconnect();\r\n    this.drawRequest();\r\n    return Promise.all(this.playoutPromises);\r\n  }\r\n\r\n  rewind() {\r\n    return this.stop().then(() => {\r\n      this.scrollLeft = 0;\r\n      this.ee.emit(\"select\", 0, 0);\r\n    });\r\n  }\r\n\r\n  fastForward() {\r\n    return this.stop().then(() => {\r\n      if (this.viewDuration < this.duration) {\r\n        this.scrollLeft = this.duration - this.viewDuration;\r\n      } else {\r\n        this.scrollLeft = 0;\r\n      }\r\n\r\n      this.ee.emit(\"select\", this.duration, this.duration);\r\n    });\r\n  }\r\n\r\n  clear() {\r\n    return this.stop().then(() => {\r\n      this.tracks = [];\r\n      this.soloedTracks = [];\r\n      this.mutedTracks = [];\r\n      this.playoutPromises = [];\r\n\r\n      this.cursor = 0;\r\n      this.playbackSeconds = 0;\r\n      this.duration = 0;\r\n      this.scrollLeft = 0;\r\n\r\n      this.seek(0, 0, undefined);\r\n    });\r\n  }\r\n\r\n  record() {\r\n    const playoutPromises = [];\r\n    const start = this.cursor;\r\n\r\n    if (!this.isPlaying() && this.mediaRecorder && this.mediaRecorder.state === \"paused\") {\r\n      // console.log(\"media recorder resume\\n\");\r\n      this.mediaRecorder.resume();\r\n    }\r\n\r\n    if (!this.isPlaying() && this.mediaRecorder && this.mediaRecorder.state !== \"recording\" && this.mediaRecorder.state !== \"paused\") {\r\n\r\n      this.mediaRecorder.start(300);\r\n\r\n      this.tracks.forEach((track) => {\r\n        track.setState(\"none\");\r\n        playoutPromises.push(\r\n          track.schedulePlay(this.ac.currentTime, start, undefined, {\r\n            shouldPlay: this.shouldTrackPlay(track),\r\n          })\r\n        );\r\n      });\r\n\r\n      this.playoutPromises = playoutPromises;\r\n    }\r\n  }\r\n\r\n  startAnimation(startTime) {\r\n    this.lastDraw = this.ac.currentTime;\r\n    this.animationRequest = window.requestAnimationFrame(() => {\r\n      this.updateEditor(startTime);\r\n    });\r\n  }\r\n\r\n  stopAnimation() {\r\n    window.cancelAnimationFrame(this.animationRequest);\r\n    this.lastDraw = undefined;\r\n  }\r\n\r\n  seek(start, end, track) {\r\n    if (this.isPlaying()) {\r\n      this.lastSeeked = start;\r\n      this.pausedAt = undefined;\r\n      this.restartPlayFrom(start);\r\n    } else {\r\n      // reset if it was paused.\r\n      this.setActiveTrack(track || this.tracks[0]);\r\n      this.pausedAt = start;\r\n      this.setTimeSelection(start, end);\r\n      if (this.getSeekStyle() === \"fill\") {\r\n        this.playbackSeconds = start;\r\n      }\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Animation function for the playlist.\r\n   * Keep under 16.7 milliseconds based on a typical screen refresh rate of 60fps.\r\n   */\r\n  updateEditor(cursor) {\r\n    const currentTime = this.ac.currentTime;\r\n    const selection = this.getTimeSelection();\r\n    const cursorPos = cursor || this.cursor;\r\n    const elapsed = currentTime - this.lastDraw;\r\n\r\n    if (this.isPlaying()) {\r\n      const playbackSeconds = cursorPos + elapsed;\r\n      this.ee.emit(\"timeupdate\", playbackSeconds);\r\n      this.animationRequest = window.requestAnimationFrame(() => {\r\n        this.updateEditor(playbackSeconds);\r\n      });\r\n\r\n      this.playbackSeconds = playbackSeconds;\r\n      this.draw(this.render());\r\n      this.lastDraw = currentTime;\r\n    } else {\r\n      if (\r\n        cursorPos + elapsed >=\r\n        (this.isSegmentSelection() ? selection.end : this.duration)\r\n      ) {\r\n        this.ee.emit(\"finished\");\r\n      }\r\n\r\n      this.stopAnimation();\r\n\r\n      this.resetDrawTimer = setTimeout(() => {\r\n        this.pausedAt = undefined;\r\n        this.lastSeeked = undefined;\r\n        this.setState(this.getState());\r\n\r\n        this.playbackSeconds = 0;\r\n        this.draw(this.render());\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  drawRequest() {\r\n    window.requestAnimationFrame(() => {\r\n      this.draw(this.render());\r\n    });\r\n  }\r\n\r\n  draw(newTree) {\r\n    const patches = diff(this.tree, newTree);\r\n    this.rootNode = patch(this.rootNode, patches);\r\n    this.tree = newTree;\r\n\r\n    // use for fast forwarding.\r\n    this.viewDuration = pixelsToSeconds(\r\n      this.rootNode.clientWidth - this.controls.width,\r\n      this.samplesPerPixel,\r\n      this.sampleRate\r\n    );\r\n  }\r\n\r\n  getTrackRenderData(data = {}) {\r\n    const defaults = {\r\n      height: this.waveHeight,\r\n      resolution: this.samplesPerPixel,\r\n      sampleRate: this.sampleRate,\r\n      controls: this.controls,\r\n      isActive: false,\r\n      timeSelection: this.getTimeSelection(),\r\n      playlistLength: this.duration,\r\n      playbackSeconds: this.playbackSeconds,\r\n      colors: this.colors,\r\n      barWidth: this.barWidth,\r\n      barGap: this.barGap,\r\n    };\r\n\r\n    return _defaults({}, data, defaults);\r\n  }\r\n\r\n  isActiveTrack(track) {\r\n    const activeTrack = this.getActiveTrack();\r\n\r\n    if (this.isSegmentSelection()) {\r\n      return activeTrack === track;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  renderAnnotations() {\r\n    return this.annotationList.render();\r\n  }\r\n\r\n  renderTimeScale() {\r\n    const controlWidth = this.controls.show ? this.controls.width : 0;\r\n    const timeScale = new TimeScale(\r\n      this.duration,\r\n      this.scrollLeft,\r\n      this.samplesPerPixel,\r\n      this.sampleRate,\r\n      controlWidth,\r\n      this.colors\r\n    );\r\n\r\n    return timeScale.render();\r\n  }\r\n\r\n  renderTrackSection() {\r\n    const trackElements = this.tracks.map((track) => {\r\n      const collapsed = this.collapsedTracks.indexOf(track) > -1;\r\n      return track.render(\r\n        this.getTrackRenderData({\r\n          isActive: this.isActiveTrack(track),\r\n          shouldPlay: this.shouldTrackPlay(track),\r\n          soloed: this.soloedTracks.indexOf(track) > -1,\r\n          muted: this.mutedTracks.indexOf(track) > -1,\r\n          collapsed,\r\n          height: collapsed ? this.collapsedWaveHeight : this.waveHeight,\r\n          barGap: this.barGap,\r\n          barWidth: this.barWidth,\r\n        })\r\n      );\r\n    });\r\n\r\n    return h(\r\n      \"div.playlist-tracks\",\r\n      {\r\n        attributes: {\r\n          style: \"overflow: auto;\",\r\n        },\r\n        onscroll: (e) => {\r\n          this.scrollLeft = pixelsToSeconds(\r\n            e.target.scrollLeft,\r\n            this.samplesPerPixel,\r\n            this.sampleRate\r\n          );\r\n\r\n          this.ee.emit(\"scroll\");\r\n        },\r\n        hook: new ScrollHook(this),\r\n      },\r\n      trackElements\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const containerChildren = [];\r\n\r\n    if (this.showTimescale) {\r\n      containerChildren.push(this.renderTimeScale());\r\n    }\r\n\r\n    containerChildren.push(this.renderTrackSection());\r\n\r\n    if (this.annotationList.length) {\r\n      containerChildren.push(this.renderAnnotations());\r\n    }\r\n\r\n    return h(\r\n      \"div.playlist\",\r\n      {\r\n        attributes: {\r\n          style: \"overflow: hidden; position: relative;\",\r\n        },\r\n      },\r\n      containerChildren\r\n    );\r\n  }\r\n\r\n  getInfo() {\r\n    const tracks = [];\r\n\r\n    this.tracks.forEach((track) => {\r\n      tracks.push(track.getTrackDetails());\r\n    });\r\n\r\n    return {\r\n      tracks,\r\n      effects: this.effectsGraph,\r\n    };\r\n  }\r\n\r\n\r\n  //----------- HERTZJS --------------\r\n\r\n  /**\r\n   * This method is called by the event listener.\r\n   * This method syncs the hertzjs project to the current waveform project.\r\n   * Hertjz supports multiple clips per track, however waveform does not, and for that, each hertzjs clip\r\n   * will be stored in a separate waveform track.\r\n   */\r\n  async copyFromHertzjs(hertjzProject) {\r\n    this.tracks = []\r\n    hertjzProject.tracks.forEach((hertzjsTrack) => {\r\n      hertzjsTrack.clips.forEach(async hertjzClip => {\r\n        //Create a new waveform track\r\n        //console.log('NIDHAL-LOG:syncWithHertjs-1', hertjzClip.path)\r\n        const track = {\r\n          src: hertjzClip.path,\r\n          name: hertjzClip.path.includes('/') ? hertjzClip.path.match(/\\/([^/]+)$/)[1] : hertjzClip.path,\r\n          start: hertjzClip.startsAt,\r\n          cuein: hertjzClip.offset,\r\n          cueout: hertjzClip.duration\r\n        }\r\n        //Add effects\r\n        hertjzClip.effects.forEach(hertzjsEffect => {\r\n          switch (hertzjsEffect.name) {\r\n            case 'fade-in':\r\n              if (hertzjsEffect.params && hertzjsEffect.params.duration > 0) {\r\n                track.fadeIn = {\r\n                  duration: hertzjsEffect.params.duration\r\n                }\r\n              }\r\n              break;\r\n\r\n            case 'fade-out':\r\n              if (hertzjsEffect.params && hertzjsEffect.params.duration > 0) {\r\n                track.fadeOut = {\r\n                  duration: hertzjsEffect.params.duration\r\n                }\r\n              }\r\n              break;\r\n          }\r\n        })\r\n        this.load([track]);\r\n        //console.log(this.tracks)\r\n      })\r\n    })\r\n  }\r\n\r\n  commit() {\r\n    if (!this.hertzjsProject) {\r\n      this.hertzjsProject = new AudioProject();\r\n      //console.log('Creating a new Hertzjs Instance')\r\n    }\r\n\r\n    window.hjz = this.hertzjsProject;\r\n    //Copy all the waveform settings to hertzjs and commits the change\r\n    //Delete all the tracks in hertzjs in the current version \r\n    this.hertzjsProject.tracks = [];\r\n    this.tracks.forEach(track => {\r\n      let hertzjsTrack = this.hertzjsProject.newTrack();\r\n      //TODO: if the files are local, we need to copy them locally\r\n      let hertzjsClip = undefined;\r\n      if (track.src instanceof File) {\r\n        let url = URL.createObjectURL(track.src)\r\n        //console.log('File is not a string, it is a file, creating a blog and a url and referencing it', url)\r\n        hertzjsClip = hertzjsTrack.newClip(url);\r\n\r\n      }\r\n      else if (typeof track.src === 'string' || track.src instanceof String) {\r\n        hertzjsClip = hertzjsTrack.newClip(track.src);\r\n      }\r\n      else if (typeof (track) == 'object' && !!track.buffer) {\r\n        //This is an audio buffer, so we create a temporary file from it\r\n        const audioBuffer = track.buffer;\r\n        const wavBuffer = AudioBufferToWav(audioBuffer);\r\n        const blob = new window.Blob([new DataView(wavBuffer)], {\r\n          type: 'audio/wav'\r\n        })\r\n        var url = window.URL.createObjectURL(blob)\r\n\r\n        hertzjsClip = hertzjsTrack.newClip(url);\r\n\r\n\r\n\r\n      }\r\n      hertzjsClip.setStartsAt(track.startTime)\r\n      hertzjsClip.setDuration(track.cueOut)\r\n      hertzjsClip.setOffset(track.cueIn)\r\n      //TODO:Add effects here\r\n    })\r\n    this.hertzjsProject.commit()\r\n  }\r\n\r\n  undo() {\r\n    if (!this.hertzjsProject)\r\n      return false;\r\n\r\n    let currentIndex = this.hertzjsProject.history.currentIndex;\r\n    if (currentIndex <= 1)\r\n      return false;\r\n    this.hertzjsProject.undo();\r\n    this.copyFromHertzjs(this.hertzjsProject)\r\n  }\r\n\r\n  redo() {\r\n    let isInLastVersion = this.hertzjsProject.isInLastVersion();\r\n    if (isInLastVersion)\r\n      return false;\r\n    //console.log('currently in the', this.hertzjsProject.history.currentIndex, 'version', isInLastVersion ? ' LAST VERSION' : '')\r\n    this.hertzjsProject.redo();\r\n    this.copyFromHertzjs(this.hertzjsProject)\r\n  }\r\n\r\n  getHertjzProjectInstance() {\r\n    return this.hertzjsProject;\r\n  }\r\n\r\n\r\n  /**\r\n   * This method will export the project as a zip file\r\n   */\r\n  exportZipProject() {\r\n    const zip = new JSZip();\r\n    zip.file('project.json', JSON.stringify(this.hertzjsProject));\r\n    zip.file('README.txt', 'Nothing here!');\r\n\r\n    const fetchPromises = [];\r\n\r\n    //Now we'll be saving all the media files for the current version\r\n    this.hertzjsProject.tracks.forEach(track => {\r\n      track.clips.forEach(clip => {\r\n        //console.log('Processing clip', clip)\r\n        if (clip.path.indexOf(\"blob:\") >= 0) {\r\n\r\n          //console.log('adding the file', clip.path)\r\n\r\n          const fetchPromise = fetch(clip.path).then(resp => resp.blob()).then(data => {\r\n            //console.log('adding file to zip', data)\r\n\r\n            let fileName = clip.path.split('/').pop()\r\n            zip.file('blob.' + fileName, data)\r\n\r\n          });\r\n          fetchPromises.push(fetchPromise)\r\n        }\r\n      })\r\n    })\r\n\r\n    return Promise.all(fetchPromises).then(() => {\r\n      // Generate the ZIP file after all operations are finished\r\n      return zip.generateAsync({ type: 'blob' });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * This method accepts a ZIP project\r\n   * The project must containa a file called project.json and the medias referenced in it\r\n   * @param {} zipFile \r\n   */\r\n  importZipProject(zipFile) {\r\n    const playlist = this;\r\n\r\n    if (!playlist.hertzjsProject)\r\n      this.commit();\r\n\r\n\r\n    // Load the ZIP file using JSZip\r\n    JSZip.loadAsync(zipFile /* Blob containing the ZIP file */).then(zip => {\r\n\r\n\r\n\r\n\r\n      //First we read the project.json file\r\n      zip.file(\"project.json\").async(\"blob\").then(projectFileBlob => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = function (event) {\r\n\r\n          //We readt the projet object from the file and copy it in the memory\r\n          let projectJson = event.target.result\r\n          let projectObject = JSON.parse(projectJson)\r\n\r\n          playlist.hertzjsProject.history.setHistoryStack(projectObject.history.stack)\r\n          playlist.hertzjsProject.history.setCooldownState(projectObject.history.cooldownState)\r\n          playlist.hertzjsProject.history.setCurrentIndex(projectObject.history.currentIndex)\r\n          playlist.hertzjsProject.history.setCooldown(projectObject.history.cooldown)\r\n          playlist.hertzjsProject.tracks = projectObject.tracks\r\n\r\n\r\n          // Loop through each file in the ZIP archive\r\n          const fileLoadingPromises = [];\r\n          zip.forEach(function (relativePath, zipEntry) {\r\n            // Check if it's a file (not a directory)\r\n            if (!zipEntry.dir) {\r\n              if (zipEntry.name == 'project.json')\r\n                return\r\n\r\n              // Extract the file content as a Blob\r\n              const fileLoadingPromise = zipEntry.async(\"blob\").then(function (fileBlob) {\r\n                // Use fileBlob here (for example, create an object URL to display images, or read text content)\r\n                // console.log(\"File Name: \" + zipEntry.name);\r\n\r\n                //If the file is a temporary blob file, we simply generate a url for it and update the project\r\n                //to reference the new temporary url\r\n                if (zipEntry.name.substring(0, 5) == 'blob.') {\r\n                  let newUrl = URL.createObjectURL(fileBlob)\r\n\r\n                  playlist.hertzjsProject.tracks.forEach(track => {\r\n                    track.clips.forEach(clip => {\r\n                      // console.log('checking clip', clip.path)\r\n\r\n                      let clipFileName = clip.path.split('/').pop()\r\n\r\n                      if (clipFileName == zipEntry.name.substring(5)) {\r\n                        clip.path = newUrl\r\n                        // console.log('updating clip', clip.path, 'to', newUrl)\r\n                      }\r\n\r\n                    })\r\n                  })\r\n                  //TODO: find all the references in the in all the history versions as well and update them\r\n                }\r\n\r\n              });\r\n              fileLoadingPromises.push(fileLoadingPromise);\r\n            }\r\n          });\r\n\r\n          Promise.all(fileLoadingPromises).then(() => {\r\n\r\n            // console.log('copying from hertzjs')\r\n            playlist.copyFromHertzjs(playlist.hertzjsProject);\r\n\r\n          })\r\n\r\n\r\n\r\n        };\r\n        reader.readAsText(projectFileBlob);\r\n      })\r\n\r\n\r\n\r\n\r\n    });\r\n\r\n  }\r\n}\r\n\r\n"],"mappings":"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","ignoreList":[]}]}